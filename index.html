<style type="text/css">/* 1. NEUTRALIZADOR: Ocultamos TODO el diseño del sitio original (Lumen) */
#cinta-telefono, .cinta-negra,
header.general-header, .general-header, .menu-h,
#menu-movil, .contenedor-menu-movil,
.breadcrumb, h1.h-titulo,
footer.general-footer, .general-footer,
#backtoup, .backtoup,
#livechat-compact-container, .zopim {
    display: none !important;
}
/* 2. AJUSTE DE PANTALLA: Quitamos barras de desplazamiento innecesarias y forzamos altura */
body.general-body, body, html {
    margin: 0 !important;
    padding: 0 !important;
    height: 100% !important;
    background-color: #ffffff !important;
}
/* 3. ROMPER CONTENEDORES: Aseguramos ancho completo */
main.general-main-content, .contenedor-principal, .contenido-superior {
    max-width: 100vw !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
}
</style>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumen - Impresión Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script type="text/javascript" src="https://cdn.conekta.io/js/latest/conekta.js"></script>
    <!-- Iconos para decoración -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --lumen-blue: #0a2342;
            --lumen-red: #d90429;
            --lumen-yellow: #fecb00;
        }
        .bg-lumen-blue { background-color: var(--lumen-blue); }
        .bg-lumen-red { background-color: var(--lumen-red); }
        .bg-lumen-yellow { background-color: var(--lumen-yellow); }
        .text-lumen-blue { color: var(--lumen-blue); }
        .text-lumen-red { color: var(--lumen-red); }
        .text-lumen-yellow { color: var(--lumen-yellow); }
        .border-lumen-red { border-color: var(--lumen-red); }
        .border-lumen-blue { border-color: var(--lumen-blue); }
        .filter-btn-active {
            background-color: var(--lumen-blue) !important;
            color: white !important;
            border-color: var(--lumen-blue) !important;
        }
        @keyframes appear {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .appear-animate {
            animation: appear 0.7s ease-out forwards;
            opacity: 0;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .pdf-uploader {
            background-color: #f0f6ff;
            border: 2px dashed var(--lumen-blue);
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease-out;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 300px;
        }
        .pdf-uploader.dragover {
            background-color: #e0eaff;
            border-style: solid;
        }
        .pdf-uploader svg {
            color: var(--lumen-blue);
            margin: 0 auto 1rem;
        }
        .pdf-viewer-wrap {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            background: #f9fafb;
        }
        .pdf-viewer-toolbar {
            padding: 0.75rem 1rem;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .select-disabled {
            background-color: #f3f4f6;
            cursor: not-allowed;
            opacity: 0.7;
        }
        [x-cloak] { display: none !important; }
        #pdf-preview {
            width: 100%;
            height: 70vh;
            border: none;
        }
        /* Estilos específicos para la animación del texto (Marquee) */
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
            position: relative;
        }
        .marquee-content {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 20s linear infinite;
        }
        @keyframes marquee {
            0% {
                transform: translate(0, 0);
            }
            100% {
                transform: translate(-100%, 0);
            }
        }
        /* Clase para ocultar el banner suavemente */
        .banner-hidden {
            display: none;
        }
        body {
            padding-top: 80px; /* Padding inicial aproximado para mobile (h-20 = 80px) */
        }
        @media (min-width: 768px) {
            body {
                padding-top: 80px; /* Para desktop (h-20 = 80px) */
            }
        }
        /* Estilos para notificaciones flotantes */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 40; /* Bajo modales (z-50) y header (z-50) */
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            transition: opacity 0.3s ease;
        }
        .notification.hidden {
            display: none;
        }
        .close-btn {
            position: absolute;
            top: 4px;
            right: 8px;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
<script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        const allProducts = {
            'impresion-bn': {id_slug: 'impresion-bn',name: 'Impresión B/N',price: '1.50',category: 'impresiones',img: '/docs/impresion-blanco-y-negro',description: ['Impresión láser de alta calidad en blanco y negro.', 'Perfecto para documentos, tareas y reportes.'],requiresFile: true,requiresPageRange: true,sucursalesDisponibles: ['Sucursal Angelopolis', 'Sucursal Anahuac Sur', 'Sucursal Anahuac Norte', 'Sucursal Las Águilas', 'Sucursal La Salle', 'Sucursal Ibero', 'Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox', 'Sucursal Col. Valle', 'Sucursal Satelite']},
            'impresion-color': {id_slug: 'impresion-color',name: 'Impresiones Color',price: '15.50',category: 'impresiones',img: '/docs/impresion-color',description: ['Colores vibrantes en impresión láser.', 'Ideal para presentaciones, gráficas y folletos.'],requiresFile: true,requiresPageRange: true,sucursalesDisponibles: ['Sucursal Angelopolis', 'Sucursal Anahuac Sur', 'Sucursal Anahuac Norte', 'Sucursal Las Águilas', 'Sucursal La Salle', 'Sucursal Ibero', 'Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox', 'Sucursal Col. Valle', 'Sucursal Satelite']},
            'ploteo-color': {id_slug: 'ploteo-color',name: 'Ploteo Color',price: '1.50',category: 'impresiones',img: '/docs/ploteo-color',description: ['Impresión de gran formato a color.', 'Ideal para posters, banners y material publicitario.'],requiresFile: true,requiresPageRange: true,sucursalesDisponibles: ['Sucursal Angelopolis', 'Sucursal Anahuac Sur', 'Sucursal Anahuac Norte', 'Sucursal Las Águilas', 'Sucursal Agora', 'Sucursal La Salle', 'Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox', 'Sucursal Col. Valle', 'Sucursal Satelite']},
            'ploteo-planos-bn': {id_slug: 'ploteo-planos-bn',name: 'Ploteo Planos B/N',price: '0.50',category: 'impresiones',img: '/docs/ploteo-blanco-y-negro',description: ['Impresión de planos en blanco y negro.', 'Alta precisión para arquitectura e ingeniería.'],requiresFile: true,requiresPageRange: true,sucursalesDisponibles: ['Sucursal Angelopolis', 'Sucursal Anahuac Sur', 'Sucursal Anahuac Norte', 'Sucursal Las Águilas', 'Sucursal Agora', 'Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox', 'Sucursal Col. Valle', 'Sucursal Satelite']},
            'ploteo-planos-color': {id_slug: 'ploteo-planos-color',name: 'Ploteo Planos Color',price: '1.50',category: 'impresiones',img: '/docs/ploteo-plano-color',description: ['Impresión de planos a color.', 'Resalta detalles y secciones de tus proyectos.'],requiresFile: true,requiresPageRange: true,sucursalesDisponibles: ['Sucursal Angelopolis', 'Sucursal Anahuac Sur', 'Sucursal Anahuac Norte', 'Sucursal Las Águilas', 'Sucursal Agora', 'Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox', 'Sucursal Col. Valle', 'Sucursal Satelite']},
            'impresion-tarjetas': {id_slug: 'impresion-tarjetas',name: 'Impresión tarjetas',price: '20.00',category: 'impresiones',img: '/docs/impresion-tarjetas',description: ['Impresión de tarjetas de presentación y credenciales.', 'Disponibles en PVC y otros materiales.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox', 'Sucursal Col. Valle', 'Sucursal Satelite']},
            'ecuadernado': {id_slug: 'ecuadernado',name: 'Ecuadernado',price: '59.00',category: 'promocionales',img: '/docs/encuadernado',description: ['Acabado profesional para tus documentos.', 'Disponible en pasta dura y flexible.'],requiresFile: true,requiresPageRange: true,sucursalesDisponibles: ['Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox', 'Sucursal Col. Valle', 'Sucursal Satelite']},
            'engargolado': {id_slug: 'engargolado',name: 'Engargolado',price: '24.00',category: 'promocionales',img: '/docs/engargolado',description: ['Engargolado con espiral de plástico.', 'Ideal para manuales y presentaciones.'],requiresFile: true,requiresPageRange: true,sucursalesDisponibles: ['Sucursal Angelopolis', 'Sucursal UDEM', 'Sucursal Anahuac Sur', 'Sucursal Anahuac Norte', 'Sucursal Las Águilas', 'Sucursal Agora', 'Sucursal La Salle', 'Sucursal Ibero', 'Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox', 'Sucursal Col. Valle', 'Sucursal Satelite']},
            'sublimado-taza': {id_slug: 'sublimado-taza',name: 'Taza',price: '85.00',category: 'sublimados',img: '/docs/taza',description: ['Personaliza tu taza con sublimación de alta calidad.', 'Ideal para regalos y promocionales.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox']},
            'sublimado-mouspad': {id_slug: 'sublimado-mouspad',name: 'MousPad',price: '59.00',category: 'sublimados',img: '/docs/mousepad',description: ['Mousepad personalizado con sublimación.', 'Superficie suave y antideslizante.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox']},
            'sublimado-rompecabezas': {id_slug: 'sublimado-rompecabezas',name: 'Rompecabezas',price: '75.00',category: 'sublimados',img: '/docs/rompecabezas',description: ['Rompecabezas personalizado con tu imagen favorita.', 'Diversión garantizada para todas las edades.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Hiperlumen Valle', 'Sucursal Polanco', 'Sucursal Relox']},
            'sublimado-botella-aluminio': {id_slug: 'sublimado-botella-aluminio',name: 'Botella Aluminio',price: '175.00',category: 'sublimados',img: '/docs/botella-aluminio',description: ['Botella de aluminio personalizada.', 'Resistente y ecológica.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Relox']},
            'sublimado-piedra': {id_slug: 'sublimado-piedra',name: 'Piedra',price: '249.00',category: 'sublimados',img: '/docs/piedra',description: ['Piedra decorativa con sublimación.', 'Perfecta para recuerdos o decoración.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Polanco', 'Sucursal Relox']},
            'sublimado-taza-conica': {id_slug: 'sublimado-taza-conica',name: 'Taza Cónica',price: '129.00',category: 'sublimados',img: '/docs/taza-conica',description: ['Taza cónica personalizada con sublimación.', 'Diseño ergonómico y elegante.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Relox']},
            'sublimado-thermo-bala': {id_slug: 'sublimado-thermo-bala',name: 'Thermo Bala',price: '499.00',category: 'sublimados',img: '/docs/termo-bala',description: ['Thermo tipo bala personalizado.', 'Mantiene bebidas calientes/frías por horas.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Polanco', 'Sucursal Relox']},
            'sublimado-vaso-acero': {id_slug: 'sublimado-vaso-acero',name: 'Vaso Acero',price: '599.00',category: 'sublimados',img: '/docs/vaso-acero',description: ['Vaso de acero inoxidable con sublimación.', 'Duradero y estilizado.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Relox']},
            'sublimado-boton-publicitario': {id_slug: 'sublimado-boton-publicitario',name: 'Botón Publicitario 2 1/4',price: '85.00',category: 'sublimados',img: '/docs/foto-boton',description: ['Botón publicitario personalizado.', 'Ideal para campañas y eventos.'],requiresFile: true,requiresPageRange: false,sucursalesDisponibles: ['Sucursal Polanco', 'Sucursal Relox', 'Sucursal Col. Valle', 'Sucursal Satelite']}
        };
        const sucursalesInfo = {
            'Sucursal Satelite': { direccion: 'Av. Circuito Geógrafos No. 30, Cd. Satélite, Naucalpan, Edo. de México, CP 53100', mapsLink: 'https://maps.app.goo.gl/Fhin2skZPcXUhziG8' },
            'Sucursal Col. Valle': { direccion: 'Av. Colonia del Valle No. 217, Col. Del Valle, CDMX, CP 03100', mapsLink: 'https://maps.app.goo.gl/EejCwHmvh8nWw9Q36' },
            'Sucursal Relox': { direccion: 'Av. Insurgentes Sur No. 2394, Col. Chimalistac, CDMX, CP 01070', mapsLink: 'https://maps.app.goo.gl/AdU7Dy1YLKAmJram6' },
            'Sucursal Polanco': { direccion: 'Calle Arquímedes 44, Polanco, CDMX', mapsLink: 'https://maps.app.goo.gl/rmYdsQ3UcqJ9neuA8' },
            'Sucursal Hiperlumen Valle': { direccion: 'Adolfo Prieto No. 1439, Col. Del Valle, CDMX, CP 03100', mapsLink: 'https://maps.app.goo.gl/VwfbS7yF8DbcvgNP8' },
            'Sucursal Ibero': { direccion: 'Prol. Paseo de la Reforma No. 880, Col. Santa Fe, CDMX, CP 01210', mapsLink: 'https://maps.app.goo.gl/xzQqZDM8X4xumJtf9' },
            'Sucursal La Salle': { direccion: 'Benjamín Franklin No. 37, Col. Hipódromo Condesa, CDMX, CP 06140', mapsLink: 'https://maps.app.goo.gl/xuYTtNGtHtnwv48z9' },
            'Sucursal Agora': { direccion: 'Ex Hacienda Santa Catarina s/n, San Andrés Cholula, Puebla, CP 72810', mapsLink: 'https://maps.app.goo.gl/F1YXexFQZc4pyqaE7' },
            'Sucursal Las Águilas': { direccion: 'Calz. de las Águilas No. 1681, Col. Lomas de Guadalupe, Álvaro Obregón, CDMX, CP 01720', mapsLink: 'https://maps.app.goo.gl/dt92otWESR9ESbm89' },
            'Sucursal Anahuac Norte': { direccion: 'Av. Universidad Anáhuac No. 46, Lomas Anáhuac, Naucalpan, Edo. de México, CP 52786', mapsLink: 'https://maps.app.goo.gl/quVVvujXSgqGMwYj6' },
            'Sucursal Anahuac Sur': { direccion: 'Av. de las Torres 131, Col. Torres de Potrero, Álvaro Obregón, CDMX, CP 01840', mapsLink: 'https://maps.app.goo.gl/fkZhSn9tfQra5GbX7' },
            'Sucursal UDEM': { direccion: 'Av. José Calderón No. 301, Col. Jesús M. Garza, San Pedro Garza García, Nuevo León, CP 66238', mapsLink: 'https://maps.app.goo.gl/MrJ9NhLdTnDr5y3z6' },
            'Sucursal Angelopolis': { direccion: 'Av. Osa Mayor No. 2902, Reserva Territorial Atlixcáyotl, San Andrés Cholula, Puebla, CP 72800', mapsLink: 'https://maps.app.goo.gl/2321JWc8wV96vDch6' }
        };
        const mayoreoLimits = {
            'Impresión B/N': 301, // páginas
            'Impresiones Color': 251, // páginas
            'Ploteo Color': 16, // unidades
            'Ploteo Planos B/N': 21, // unidades
            'Ploteo Planos Color': 16, // unidades
            'Impresión tarjetas': 151, // tarjetas
            'Ecuadernado': 3, // unidades
            'Engargolado': 6, // unidades
            'Taza': 21, // unidades
            'MousPad': 46, // unidades
            'Rompecabezas': 37, // unidades
            'Botella Aluminio': 12, // unidades
            'Piedra': 11, // unidades
            'Taza Cónica': 19, // unidades
            'Thermo Bala': 14, // unidades
            'Vaso Acero': 10, // unidades
            'Botón Publicitario 2 1/4': 61 // unidades
        };
        function carousel() {
            return {
                scrollLeft() { this.$refs.slider.scrollBy({ left: -300, behavior: 'smooth' }); },
                scrollRight() { this.$refs.slider.scrollBy({ left: 300, behavior: 'smooth' }); }
            }
        }
        function app() {
            return {
                view: 'home',
                currentProduct: null,
                serviceMap: {
                    'impresion-bn': 'Impresión B/N',
                    'impresion-color': 'Impresiones Color',
                    'ploteo-color': 'Ploteo Color',
                    'ploteo-planos-bn': 'Ploteo Planos B/N',
                    'ploteo-planos-color': 'Ploteo Planos Color',
                    'impresion-tarjetas': 'Impresión tarjetas',
                    'ecuadernado': 'Ecuadernado',
                    'engargolado': 'Engargolado',
                    'sublimado-taza': 'Taza',
                    'sublimado-mouspad': 'MousPad',
                    'sublimado-rompecabezas': 'Rompecabezas',
                    'sublimado-botella-aluminio': 'Botella Aluminio',
                    'sublimado-piedra': 'Piedra',
                    'sublimado-taza-conica': 'Taza Cónica',
                    'sublimado-thermo-bala': 'Thermo Bala',
                    'sublimado-vaso-acero': 'Vaso Acero',
                    'sublimado-boton-publicitario': 'Botón Publicitario 2 1/4'
                },
                cart: [],
                showCartModal: false,
                filter: 'todo',
                configDB: [],
                dataLoaded: false,
                dataError: null,
                available: {
                    materiales: [],
                    productos: [],
                    caras: [],
                    detalles: []
                },
                configState: {
                    serviceId: null,
                    material: '',
                    producto: '',
                    caras: '',
                    detalles: '',
                    pageRange: '',
                    orientacion: '',
                    cantidad: 1,
                    impresionType: 'bn', // Default to B/N since 'none' is removed
                    impresionCaras: '1 cara (frente)',
                    extraArillo: false,
                    finalPrice: 0,
                    finalDetail: '',
                    finalCode: '',
                    errorMessage: '',
                    editingItemId: null
                },
                customer: {
                    name: '',
                    email: '',
                    phone: ''
                },
                sucursal: '',
                sucursales: ['Sucursal Satelite', 'Sucursal Col. Valle', 'Sucursal Relox', 'Sucursal Polanco', 'Sucursal Hiperlumen Valle', 'Sucursal Ibero', 'Sucursal La Salle', 'Sucursal Agora', 'Sucursal Las Águilas', 'Sucursal Anahuac Norte', 'Sucursal Anahuac Sur', 'Sucursal UDEM', 'Sucursal Angelopolis'],
                termsAccepted: false,
                isProcessing: false,
                checkoutMessage: { type: '', text: '' },
                formErrors: {
                    name: '',
                    email: '',
                    phone: '',
                    sucursal: '',
                    terms: '',
                    card_number: '',
                    exp_month: '',
                    exp_year: '',
                    cvc: ''
                },
                lastOrder: {
                    orderId: null,
                    customer: {},
                    sucursal: null,
                    items: [],
                    total: 0
                },
                pdf: {
                    file: null,
                    fileName: '',
                    isDragOver: false,
                    numPages: 0,
                    error: null,
                    pdfDoc: null,
                    previewSrc: ''
                },
                selectedSucursal: localStorage.getItem('selectedSucursal') || '',
                showSucursalModal: !localStorage.getItem('selectedSucursal'),
                tempSuc: '',
                isFriday: new Date().getDay() === 5,
                discountRate: 0.20,
                isOutsideHours() {
                    const now = new Date();
                    const hour = now.getHours();
                    const minute = now.getMinutes();
                    return hour < 9 || (hour > 17 || (hour === 17 && minute > 30));
                },
                infoMessages: [
                    'Horarios de entrega: Antes de 9 AM - 3h después de 9 AM',
                    'Después de 5:30 PM - Siguiente día después de las 10 AM',
                    'Mayoreo (>500 hojas B/N o Color) - Siguiente día, notificación por correo/WhatsApp'
                ],
                currentMessageIndex: 0,
                processFile(file) {
                    if (!file) return;
                    if (file.type !== 'application/pdf') {
                        this.pdf.error = 'Error: Solo se permiten archivos PDF.';
                        return;
                    }
                    if (file.size > 100 * 1024 * 1024) {
                        this.pdf.error = 'Error: El archivo no debe pesar más de 100 MB.';
                        return;
                    }
                    this.pdf.file = file;
                    this.pdf.fileName = file.name;
                    this.pdf.error = null;
                    this.pdf.previewSrc = URL.createObjectURL(file);
                    const loadingTask = pdfjsLib.getDocument(this.pdf.previewSrc);
                    loadingTask.promise.then(pdf => {
                        this.pdf.pdfDoc = pdf;
                        this.pdf.numPages = pdf.numPages;
                        this.findPrice();
                    }).catch(err => {
                        this.pdf.error = 'Error al cargar PDF: ' + err.message;
                    });
                },
                handleFileSelect(event) {
                    const file = event.target.files && event.target.files[0];
                    this.processFile(file);
                    event.target.value = '';
                },
                handleFileDrop(event) {
                    this.pdf.isDragOver = false;
                    const file = event.dataTransfer.files && event.dataTransfer.files[0];
                    this.processFile(file);
                },
                clearPdfViewer() {
                    this.pdf.file = null;
                    this.pdf.fileName = '';
                    this.pdf.error = null;
                    this.pdf.pdfDoc = null;
                    this.pdf.numPages = 0;
                    this.pdf.previewSrc = '';
                    this.findPrice();
                },
                getUniqueOptions(data, key) {
                    return [...new Set(data.map(item => item[key]))];
                },
                parsePageRange(rangeStr) {
                    if (!rangeStr || rangeStr.trim() === '') {
                        return this.pdf.numPages || 0;
                    }
                    let totalCount = 0;
                    const parts = rangeStr.split(',');
                    for (let part of parts) {
                        part = part.trim();
                        if (part.includes('-')) {
                            const [start, end] = part.split('-').map(Number);
                            if (isNaN(start) || isNaN(end) || start < 1 || end < start || end > this.pdf.numPages) {
                                this.configState.errorMessage = `Rango inválido: página ${end} no existe (PDF tiene ${this.pdf.numPages} páginas)`;
                                return 0;
                            }
                            totalCount += (end - start + 1);
                        } else {
                            const page = parseInt(part, 10);
                            if (isNaN(page) || page < 1 || page > this.pdf.numPages) {
                                this.configState.errorMessage = `Página ${page} no existe`;
                                return 0;
                            }
                            totalCount += 1;
                        }
                    }
                    return totalCount;
                },
                updateConfigOptions(step) {
                    if (!this.dataLoaded || !this.configState.serviceId) return;
                    this.configState.errorMessage = '';
                    let rows = this.configDB.filter(item => item.servicio === this.configState.serviceId);
                    if (step === 'service') {
                        this.available.materiales = this.getUniqueOptions(rows, 'material');
                        this.configState.material = '';
                        this.available.productos = [];
                        this.configState.producto = '';
                        this.available.caras = [];
                        this.configState.caras = '';
                        this.available.detalles = [];
                        this.configState.detalles = '';
                    }
                    if (step === 'material') {
                        if (this.configState.material) {
                            rows = rows.filter(item => item.material === this.configState.material);
                            this.available.productos = this.getUniqueOptions(rows, 'producto');
                        } else {
                            this.available.productos = [];
                        }
                        this.configState.producto = '';
                        this.available.caras = [];
                        this.configState.caras = '';
                        this.available.detalles = [];
                        this.configState.detalles = '';
                    }
                    if (step === 'producto') {
                        if (this.configState.producto) {
                            rows = rows.filter(item => item.material === this.configState.material && item.producto === this.configState.producto);
                            this.available.caras = this.getUniqueOptions(rows, 'caras');
                        } else {
                            this.available.caras = [];
                        }
                        this.configState.caras = '';
                        this.available.detalles = [];
                        this.configState.detalles = '';
                    }
                    if (step === 'caras') {
                        if (this.configState.caras !== null && this.configState.caras !== undefined) {
                            rows = rows.filter(item =>
                                item.material === this.configState.material &&
                                item.producto === this.configState.producto &&
                                item.caras === this.configState.caras
                            );
                            this.available.detalles = this.getUniqueOptions(rows, 'detalles');
                        } else {
                            this.available.detalles = [];
                        }
                        this.configState.detalles = '';
                    }
                    this.findPrice();
                },
                findPrice() {
                    if (!this.dataLoaded) return;
                    let finalItem = this.configDB.find(item => {
                        return item.servicio === this.configState.serviceId &&
                               item.material === this.configState.material &&
                               item.producto === this.configState.producto &&
                               item.caras === this.configState.caras &&
                               item.detalles === this.configState.detalles;
                    });
                    if (finalItem) {
                        let acabadoPrice = finalItem.precio;
                        let impresionPrice = 0;
                        let pageCount = this.parsePageRange(this.configState.pageRange);
                        if (pageCount === 0 && this.currentProduct.requiresPageRange) {
                            pageCount = this.pdf.numPages || 0;
                        }
                        const isAcabado = ['engargolado', 'ecuadernado'].includes(this.currentProduct.id_slug);
                        const requiresPages = this.currentProduct.requiresPageRange && (!isAcabado || this.configState.impresionType !== 'none');
                        if (requiresPages && pageCount === 0) {
                            this.configState.errorMessage = 'Sube un PDF o ingresa un rango de páginas válido.';
                            this.configState.finalPrice = 0;
                            return;
                        }
                        if (isAcabado && this.configState.impresionType !== 'none') {
                            const serviceImp = this.configState.impresionType === 'bn' ? 'Impresión B/N' : 'Impresiones Color';
                            const impProducto = this.configState.impresionType === 'bn' ? 'Bond' : 'Papel láser';
                            const impDetalles = this.configState.impresionType === 'bn' ? 'Bond 75g' : (this.configState.material === 'Carta' ? 'Bond láser 105g' : 'Bond láser 705g Tamaño Carta');
                            const impItem = this.configDB.find(item =>
                                item.servicio === serviceImp &&
                                item.material === this.configState.material &&
                                item.producto === impProducto &&
                                item.caras === this.configState.impresionCaras &&
                                item.detalles === impDetalles
                            );
                            if (impItem) {
                                impresionPrice = impItem.precio * pageCount;
                            } else {
                                this.configState.errorMessage = 'No se encontró precio para la impresión con estas opciones.';
                                this.configState.finalPrice = 0;
                                return;
                            }
                            this.configState.finalPrice = acabadoPrice + impresionPrice;
                        } else if (this.currentProduct.requiresPageRange && !isAcabado) {
                            this.configState.finalPrice = acabadoPrice * pageCount;
                        } else {
                            this.configState.finalPrice = acabadoPrice;
                        }
                        this.configState.finalDetail = finalItem.detalles || finalItem.producto;
                        this.configState.finalCode = finalItem.codigo;
                        this.configState.errorMessage = '';
                        this.configState.finalDetail += ` - ${pageCount || this.pdf.numPages} páginas`;
                    } else {
                        this.configState.finalPrice = 0;
                        this.configState.finalDetail = 'Selecciona todas las opciones';
                        this.configState.finalCode = '---';
                    }
                },
                filteredProducts() {
                    if (!this.selectedSucursal) return Object.values(allProducts);
                    return Object.values(allProducts).filter(prod => prod.sucursalesDisponibles.includes(this.selectedSucursal));
                },
                filteredImpresiones() {
                    return this.filteredProducts().filter(prod => prod.category === 'impresiones');
                },
                filteredPromocionales() {
                    return this.filteredProducts().filter(prod => prod.category === 'promocionales');
                },
                filteredSublimados() {
                    return this.filteredProducts().filter(prod => prod.category === 'sublimados');
                },
                hasImpresiones() {
                    return this.filteredImpresiones().length > 0;
                },
                hasPromocionales() {
                    return this.filteredPromocionales().length > 0;
                },
                hasSublimados() {
                    return this.filteredSublimados().length > 0;
                },
                selectSucursal() {
                    if (this.tempSuc) {
                        this.selectedSucursal = this.tempSuc;
                        localStorage.setItem('selectedSucursal', this.tempSuc);
                        this.showSucursalModal = false;
                    }
                },
                goHome() {
                    this.view = 'home';
                    window.location.hash = '';
                },
                showProduct(productId) {
                    if (this.filteredProducts().some(p => p.id_slug === productId)) {
                        window.location.hash = productId;
                    } else {
                        alert('Este producto no está disponible en la sucursal seleccionada.');
                    }
                },
                showTerms() {
                    window.location.hash = 'terms';
                },
                showPrivacy() {
                    window.location.hash = 'privacy';
                },
                goBack() {
                    window.history.back();
                },
                handleHashChange() {
                    const hash = window.location.hash.substring(1);
                    if (hash === 'terms') {
                        this.view = 'terms';
                        window.scrollTo(0, 0);
                    } else if (hash === 'privacy') {
                        this.view = 'privacy';
                        window.scrollTo(0, 0);
                    } else if (allProducts[hash]) {
                        this.currentProduct = allProducts[hash] || null;
                        if (this.currentProduct) {
                            this.view = 'detail';
                            window.scrollTo(0, 0);
                        }
                    } else if (hash === '') {
                        this.view = 'home';
                        window.scrollTo(0, 0);
                    }
                },
                showConfig() {
                    if (!this.currentProduct || !this.dataLoaded) return;
                    this.configState.serviceId = this.serviceMap[this.currentProduct.id_slug] || null;
                    this.configState.cantidad = 1;
                    this.configState.pageRange = '';
                    this.configState.orientacion = '';
                    this.configState.impresionType = 'bn';
                    this.configState.impresionCaras = '1 cara (frente)';
                    this.configState.extraArillo = false;
                    this.configState.errorMessage = '';
                    this.configState.editingItemId = null;
                    this.updateConfigOptions('service');
                    if (this.available.materiales.length > 0) {
                        this.configState.material = this.available.materiales[0];
                        this.updateConfigOptions('material');
                    }
                    if (this.available.productos.length > 0) {
                        this.configState.producto = this.available.productos[0];
                        this.updateConfigOptions('producto');
                    }
                    if (this.available.caras.length > 0) {
                        this.configState.caras = this.available.caras[0];
                        this.updateConfigOptions('caras');
                    }
                    if (this.available.detalles.length > 0) {
                        this.configState.detalles = this.available.detalles[0];
                        this.findPrice();
                    }
                    this.pdf.file = null;
                    this.pdf.fileName = '';
                    this.pdf.error = null;
                    this.pdf.numPages = 0;
                    this.clearPdfViewer();
                    this.view = 'config';
                    window.scrollTo(0, 0);
                },
                showCart() {
                    this.view = 'cart';
                    this.checkoutMessage = { type: '', text: '' };
                    window.scrollTo(0, 0);
                },
                showCheckout() {
                    this.view = 'checkout';
                    this.checkoutMessage = { type: '', text: '' };
                    window.scrollTo(0, 0);
                    // Limpiar campos de tarjeta
                    document.getElementById('conekta-card-name').value = '';
                    document.getElementById('conekta-card-number').value = '';
                    document.getElementById('conekta-exp-month').value = '';
                    document.getElementById('conekta-exp-year').value = '';
                    document.getElementById('conekta-cvc').value = '';
                },
                showDetail() {
                    this.view = 'detail';
                    window.scrollTo(0, 0);
                },
                addToCart() {
                    this.configState.errorMessage = '';
                    if (this.configState.finalPrice <= 0) {
                        this.configState.errorMessage = "Por favor, completa todas las opciones de configuración.";
                        return;
                    }
                    if (this.currentProduct.requiresFile && !this.pdf.file) {
                        this.configState.errorMessage = "Por favor, sube tu archivo PDF para continuar.";
                        return;
                    }
                    const isAcabado = ['engargolado', 'ecuadernado'].includes(this.currentProduct.id_slug);
                    let pageCount = this.parsePageRange(this.configState.pageRange);
                    if (pageCount === 0 && this.currentProduct.requiresPageRange) {
                        pageCount = this.pdf.numPages || 0;
                    }
                    if (isAcabado && this.configState.impresionType !== 'none' && pageCount === 0) {
                        this.configState.errorMessage = "Ingresa el rango de páginas o sube un PDF para calcular las impresiones.";
                        return;
                    }
                    if (!this.currentProduct.sucursalesDisponibles.includes(this.selectedSucursal)) {
                        this.configState.errorMessage = "Este producto no está disponible en la sucursal seleccionada.";
                        return;
                    }
                    const cartItem = {
                        id: Date.now(),
                        productName: this.currentProduct.name,
                        img: this.currentProduct.img,
                        price: this.configState.finalPrice,
                        cantidad: this.configState.cantidad,
                        code: this.configState.finalCode,
                        file: this.pdf.file,
                        config: {
                            material: this.configState.material,
                            producto: this.configState.producto,
                            caras: this.configState.caras,
                            detalles: this.configState.detalles,
                            pageRange: this.configState.pageRange,
                            orientacion: this.configState.orientacion,
                            impresionType: this.configState.impresionType,
                            impresionCaras: this.configState.impresionCaras,
                            extraArillo: this.configState.extraArillo
                        },
                        sucursalesDisponibles: this.currentProduct.sucursalesDisponibles
                    };
                    this.cart.push(cartItem);
                    this.showCartModal = true;
                    this.clearPdfViewer();
                    this.configState.pageRange = '';
                    this.configState.orientacion = '';
                    this.configState.impresionType = 'bn';
                    this.configState.impresionCaras = '1 cara (frente)';
                    this.configState.extraArillo = false;
                },
                editCartItem(itemId) {
                    const itemToEdit = this.cart.find(item => item.id === itemId);
                    if (!itemToEdit) return;
                    const productSlug = Object.keys(this.serviceMap).find(key =>
                        this.serviceMap[key] === itemToEdit.productName
                    );
                    if (!productSlug) return;
                    this.currentProduct = allProducts[productSlug];
                    this.configState.serviceId = itemToEdit.productName;
                    this.configState.material = itemToEdit.config.material;
                    this.configState.producto = itemToEdit.config.producto;
                    this.configState.caras = itemToEdit.config.caras;
                    this.configState.detalles = itemToEdit.config.detalles;
                    this.configState.pageRange = itemToEdit.config.pageRange;
                    this.configState.orientacion = itemToEdit.config.orientacion || '';
                    this.configState.impresionType = itemToEdit.config.impresionType || 'bn';
                    this.configState.impresionCaras = itemToEdit.config.impresionCaras || '1 cara (frente)';
                    this.configState.extraArillo = itemToEdit.config.extraArillo || false;
                    this.configState.cantidad = itemToEdit.cantidad;
                    this.configState.editingItemId = itemToEdit.id;
                    if (itemToEdit.file) {
                        this.processFile(itemToEdit.file);
                    }
                    this.updateConfigOptions('service');
                    let rows = this.configDB.filter(i => i.servicio === this.configState.serviceId && i.material === this.configState.material);
                    this.available.productos = this.getUniqueOptions(rows, 'producto');
                    rows = rows.filter(i => i.producto === this.configState.producto);
                    this.available.caras = this.getUniqueOptions(rows, 'caras');
                    rows = rows.filter(i => i.caras === this.configState.caras);
                    this.available.detalles = this.getUniqueOptions(rows, 'detalles');
                    this.findPrice();
                    this.view = 'config';
                    window.scrollTo(0, 0);
                },
                updateCartItem() {
                    this.configState.errorMessage = '';
                    if (this.configState.finalPrice <= 0) {
                        this.configState.errorMessage = "Por favor, completa todas las opciones de configuración.";
                        return;
                    }
                    if (this.currentProduct.requiresFile && !this.pdf.file) {
                        this.configState.errorMessage = "Por favor, sube tu archivo PDF para continuar.";
                        return;
                    }
                    const isAcabado = ['engargolado', 'ecuadernado'].includes(this.currentProduct.id_slug);
                    let pageCount = this.parsePageRange(this.configState.pageRange);
                    if (pageCount === 0 && this.currentProduct.requiresPageRange) {
                        pageCount = this.pdf.numPages || 0;
                    }
                    if (isAcabado && this.configState.impresionType !== 'none' && pageCount === 0) {
                        this.configState.errorMessage = "Ingresa el rango de páginas o sube un PDF para calcular las impresiones.";
                        return;
                    }
                    if (!this.currentProduct.sucursalesDisponibles.includes(this.selectedSucursal)) {
                        this.configState.errorMessage = "Este producto no está disponible en la sucursal seleccionada.";
                        return;
                    }
                    const itemIndex = this.cart.findIndex(item => item.id === this.configState.editingItemId);
                    if (itemIndex === -1) return;
                    const updatedItem = {
                        ...this.cart[itemIndex],
                        productName: this.currentProduct.name,
                        img: this.currentProduct.img,
                        price: this.configState.finalPrice,
                        cantidad: this.configState.cantidad,
                        code: this.configState.finalCode,
                        file: this.pdf.file,
                        config: {
                            material: this.configState.material,
                            producto: this.configState.producto,
                            caras: this.configState.caras,
                            detalles: this.configState.detalles,
                            pageRange: this.configState.pageRange,
                            orientacion: this.configState.orientacion,
                            impresionType: this.configState.impresionType,
                            impresionCaras: this.configState.impresionCaras,
                            extraArillo: this.configState.extraArillo
                        },
                        sucursalesDisponibles: this.currentProduct.sucursalesDisponibles
                    };
                    this.cart[itemIndex] = updatedItem;
                    this.configState.editingItemId = null;
                    this.showCart();
                },
                removeFromCart(itemId) {
                    this.cart = this.cart.filter(item => item.id !== itemId);
                },
                isMayoreo() {
                    return this.cart.some(item => {
                        const product = item.productName;
                        if (mayoreoLimits[product]) {
                            if (['Impresión B/N', 'Impresiones Color'].includes(product)) {
                                let pages = this.parsePageRange(item.config.pageRange);
                                if (pages === 0 && item.file) pages = item.file.numPages || 0;
                                return pages * item.cantidad > mayoreoLimits[product];
                            } else {
                                return item.cantidad > mayoreoLimits[product];
                            }
                        }
                        return false;
                    });
                },
                getDeliveryMessage() {
                    const now = new Date();
                    const hour = now.getHours();
                    const minute = now.getMinutes();
                    let message = '';
                    if (this.isMayoreo()) {
                        message += 'Su pedido se considera de mayoreo y será notificado cuando esté listo vía WhatsApp. Demorará más de 3 horas, hasta un día de entrega.';
                    } else {
                        if (hour < 9 || (hour === 9 && minute === 0)) {
                            message += 'Compra antes de las 9 AM: Entrega 3 horas después de las 9 AM.';
                        } else if (hour > 17 || (hour === 17 && minute > 30)) {
                            message += 'Compra después de las 5:30 PM: Entrega al día siguiente después de las 10 AM.';
                        } else {
                            message += 'Entrega el mismo día.';
                        }
                    }
                    return message;
                },
                getCartSubtotal() {
                    return this.cart.reduce((total, item) => total + (item.price * item.cantidad), 0);
                },
                getCartTotal() {
                    let subtotal = this.getCartSubtotal();
                    if (this.isFriday) {
                        subtotal *= (1 - this.discountRate);
                    }
                    return subtotal.toFixed(2);
                },
                initCarousel() {
                    setInterval(() => {
                        this.currentMessageIndex = (this.currentMessageIndex + 1) % this.infoMessages.length;
                    }, 3000);
                },
                fileToBase64(file) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onload = () => resolve(reader.result.split(',')[1]);
                        reader.onerror = error => reject(error);
                    });
                },
                async validateAndGoToCheckout() {
                    this.checkoutMessage = { type: '', text: '' };
                    this.formErrors = { name: '', email: '', phone: '', sucursal: '', terms: '' };
                    let hasErrors = false;
                    if (!this.customer.name) { this.formErrors.name = 'Por favor, introduce tu nombre.'; hasErrors = true; }
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!this.customer.email) { this.formErrors.email = 'Por favor, introduce tu correo electrónico.'; hasErrors = true; } else if (!emailRegex.test(this.customer.email)) { this.formErrors.email = 'Por favor, introduce un correo electrónico válido.'; hasErrors = true; }
                    const phoneRegex = /^\d{10}$/;
                    if (!this.customer.phone) { this.formErrors.phone = 'Por favor, introduce tu teléfono.'; hasErrors = true; } else if (!phoneRegex.test(this.customer.phone)) { this.formErrors.phone = 'Por favor, introduce un teléfono de 10 dígitos numéricos.'; hasErrors = true; }
                    if (!this.sucursal) { this.formErrors.sucursal = 'Por favor, selecciona una sucursal.'; hasErrors = true; }
                    for (let item of this.cart) {
                        if (!item.sucursalesDisponibles.includes(this.sucursal)) {
                            this.formErrors.sucursal = `El producto "${item.productName}" no está disponible en "${this.sucursal}".`;
                            hasErrors = true;
                            break;
                        }
                    }
                    if (!this.termsAccepted) { this.formErrors.terms = 'Debes aceptar los Términos y Condiciones.'; hasErrors = true; }
                    if (hasErrors) {
                        this.checkoutMessage = { type: 'error', text: 'Por favor, corrige los errores en el formulario.' };
                        return;
                    }
                    this.view = 'checkout';
                    window.scrollTo(0, 0);
                },
                async enviarPedido() {
                    this.isProcessing = true;
                    this.checkoutMessage = { type: '', text: '' };
                    if (!this.customer || !this.customer.name || !this.customer.email || !this.sucursal) {
                        this.isProcessing = false;
                        this.checkoutMessage = { type: 'error', text: 'Faltan datos de contacto o sucursal.' };
                        return;
                    }
                    this.formErrors = { card_number: '', exp_month: '', exp_year: '', cvc: '' };
                    let hasErrors = false;
                    const cardNumber = document.getElementById('conekta-card-number').value.replace(/\s/g, '');
                    const expMonth = document.getElementById('conekta-exp-month').value;
                    const expYear = document.getElementById('conekta-exp-year').value;
                    const cvc = document.getElementById('conekta-cvc').value;
                    if (!/^\d{16}$/.test(cardNumber)) { this.formErrors.card_number = 'Revisa los 16 dígitos.'; hasErrors = true; }
                    if (!/^(0[1-9]|1[0-2])$/.test(expMonth)) { this.formErrors.exp_month = 'Mes inválido.'; hasErrors = true; }
                    const currentYear = new Date().getFullYear() % 100;
                    const currentMonth = new Date().getMonth() + 1;
                    if (!/^\d{2}$/.test(expYear) || parseInt(expYear) < currentYear || (parseInt(expYear) === currentYear && parseInt(expMonth) < currentMonth)) { this.formErrors.exp_year = 'Año inválido o tarjeta expirada.'; hasErrors = true; }
                    if (!/^\d{3,4}$/.test(cvc)) { this.formErrors.cvc = 'CVC inválido.'; hasErrors = true; }
                    if (hasErrors) {
                        this.isProcessing = false;
                        this.checkoutMessage = { type: 'error', text: 'Corrige los datos de la tarjeta.' };
                        return;
                    }
                    this.checkoutMessage = { type: 'info', text: 'Procesando pago y enviando archivos...' };
                    const orderId = `LUMEN-${Date.now()}`;
                    const total = parseFloat(this.getCartTotal());
                    try {
                        const cart_items_processed = await Promise.all(this.cart.map(async (item) => {
                            let base64Data = null;
                            if (item.file) {
                                base64Data = await this.fileToBase64(item.file);
                            }
                            return {
                                productTitle: item.productName,
                                fileName: item.file ? item.file.name : 'Sin archivo',
                                fileData: base64Data,
                                mimeType: item.file ? item.file.type : 'application/pdf',
                                cost: item.price * item.cantidad,
                                config: item.config
                            };
                        }));
                        const items_for_payment = cart_items_processed.map(item => ({
                            productTitle: item.productTitle,
                            fileName: item.fileName,
                            cost: item.cost
                        }));
                        Conekta.setPublicKey('key_SmjBYbAsKGRDQgfTf4ngYxp');
                        const form = document.getElementById('checkout-form');
                        Conekta.Token.create(form, async (token) => {
                            try {
                                const payloadBackend = {
                                    token_id: token.id,
                                    customer_info: this.customer,
                                    cart_items: items_for_payment,
                                    total_frontend: total
                                };
                                const response = await fetch('https://codigoabierto.onrender.com/procesar-pago', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(payloadBackend)
                                });
                                if (!response.ok) throw new Error('Error del servidor');
                                const data = await response.json();
                                if (data.status === 'success') {
                                    const payloadGoogle = {
                                        orderId: orderId,
                                        customer: this.customer,
                                        sucursal: this.sucursal,
                                        items: cart_items_processed,
                                        total: total
                                    };
                                    fetch('https://script.google.com/macros/s/AKfycbxLLdbZIq30c5E_b4xnp2XhNVxzqI-kNlnIF98V8SOiJVYb0ZZWDnIywnDXZcpFpN89/exec', {
                                        method: 'POST',
                                        mode: 'no-cors',
                                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                                        body: JSON.stringify(payloadGoogle)
                                    });
                                    this.lastOrder = {
                                        orderId: orderId,
                                        customer: JSON.parse(JSON.stringify(this.customer)),
                                        sucursal: this.sucursal,
                                        items: this.cart,
                                        total: total
                                    };
                                    this.isProcessing = false;
                                    this.cart = [];
                                    this.customer = { name: '', email: '', phone: '' };
                                    this.sucursal = '';
                                    this.termsAccepted = false;
                                    this.view = 'thankyou';
                                    window.scrollTo(0, 0);
                                } else {
                                    this.isProcessing = false;
                                    this.checkoutMessage = { type: 'error', text: data.message || 'Pago declinado.' };
                                }
                            } catch (err) {
                                this.isProcessing = false;
                                this.checkoutMessage = { type: 'error', text: 'Error al procesar el pago: ' + err.message };
                            }
                        }, (errConekta) => {
                            this.isProcessing = false;
                            this.checkoutMessage = { type: 'error', text: errConekta.message_to_purchaser || 'Error en datos de tarjeta.' };
                        });
                    } catch (error) {
                        this.isProcessing = false;
                        this.checkoutMessage = { type: 'error', text: 'Error inesperado. Intenta de nuevo.' };
                    }
                },
                downloadPdf() {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    doc.setFontSize(18);
                    doc.text('Confirmación de Pedido Lumen', 105, 20, { align: 'center' });
                    doc.setFontSize(12);
                    doc.text(`Pedido: #${this.lastOrder.orderId}`, 20, 40);
                    doc.text(`Cliente: ${this.lastOrder.customer.name}`, 20, 50);
                    doc.text(`Email: ${this.lastOrder.customer.email}`, 20, 60);
                    doc.text(`Teléfono: ${this.lastOrder.customer.phone}`, 20, 70);
                    doc.text(`Sucursal: ${this.lastOrder.sucursal}`, 20, 80);
                    doc.text(`Total: $${this.lastOrder.total.toFixed(2)}`, 20, 90);
                    let y = 110;
                    doc.setFontSize(14);
                    doc.text('Detalles de Items:', 20, y);
                    y += 10;
                    doc.setFontSize(10);
                    this.lastOrder.items.forEach(item => {
                        doc.text(`${item.productName} - Archivo: ${item.file ? item.file.name : 'Sin archivo'}`, 20, y);
                        y += 10;
                        doc.text(`Material: ${item.config.material || '-'} | Producto: ${item.config.producto || '-'} | Caras: ${item.config.caras || '-'}`, 30, y);
                        y += 10;
                        doc.text(`Detalles: ${item.config.detalles || '-'} | Hojas: ${item.config.pageRange || 'Todas'} | Orientación: ${item.config.orientacion || '-'}`, 30, y);
                        y += 10;
                        doc.text(`Costo: $${(item.price * item.cantidad).toFixed(2)}`, 30, y);
                        y += 15;
                    });
                    doc.setFontSize(8);
                    doc.text('© Lumen Impresión Digital - Presenta este PDF en sucursal.', 105, 280, { align: 'center' });
                    doc.save(`Pedido_${this.lastOrder.orderId}.pdf`);
                },
                // Variables de configuración de horario
                START_HOUR: 9, // 9:00 AM
                START_MIN: 0,
                END_HOUR: 17, // 5:00 PM (17:00)
                END_MIN: 30, // 30 minutos (Total 17:30 = 5:30 PM)
                // Función principal que verifica la hora
                checkTimeAndDisplay() {
                    if (sessionStorage.getItem('dismissedSchedule')) {
                        document.getElementById('schedule-notification').classList.add('hidden');
                        return;
                    }
                    let now = new Date();
                    let currentHour = now.getHours();
                    let currentMin = now.getMinutes();
                    // Convertimos todo a minutos para facilitar la comparación
                    // Ejemplo: 9:00 AM = 540 minutos desde medianoche
                    const currentTimeInMinutes = (currentHour * 60) + currentMin;
                    const startTimeInMinutes = (this.START_HOUR * 60) + this.START_MIN;
                    const endTimeInMinutes = (this.END_HOUR * 60) + this.END_MIN;
                    const tickerElement = document.getElementById('schedule-notification');
                    const tickerText = document.getElementById('ticker-text');
                    // Lógica de visualización
                    if (currentTimeInMinutes < startTimeInMinutes) {
                        // CASO 1: ANTES DE LAS 9:00 AM
                        tickerText.innerHTML = '<i class="fa-solid fa-clock mr-2"></i> Aviso: Los pedidos realizados antes de las 9:00 AM serán entregados el día de hoy después de las 10:00 AM (en un lapso de 3 horas).';
                        tickerElement.classList.remove('hidden');
                    }
                    else if (currentTimeInMinutes > endTimeInMinutes) {
                        // CASO 2: DESPUÉS DE LAS 5:30 PM (17:30)
                        tickerText.innerHTML = '<i class="fa-solid fa-moon mr-2"></i> Aviso: Los pedidos realizados después de las 5:30 PM serán entregados el día de mañana a partir de las 10:00 AM (en un lapso de 3 horas).';
                        tickerElement.classList.remove('hidden');
                    }
                    else {
                        // CASO 3: HORARIO DE SERVICIO NORMAL (ENTRE 9:00 Y 17:30)
                        tickerElement.classList.add('hidden');
                    }
                },
                closeNotification(type) {
                    if (type === 'friday') {
                        document.getElementById('friday-notification').classList.add('hidden');
                        sessionStorage.setItem('dismissedFriday', 'true');
                    } else if (type === 'schedule') {
                        document.getElementById('schedule-notification').classList.add('hidden');
                        sessionStorage.setItem('dismissedSchedule', 'true');
                    }
                },
                init() {
                    console.log("App inicializada. Cargando datos de configuración locales...");
                    window.addEventListener('hashchange', () => this.handleHashChange());
                    this.initCarousel();
                    const csvData = `Impresión B/N,Carta,Bond,1 cara (frente),Bond 75g,1.5,200033
Impresión B/N,Carta,Bond,2 caras (frente y atrás),Bond 75g,1.5,342119
Impresión B/N,Carta,Acetato,1 cara (frente),Acetato láser,10,200052
Impresión B/N,Oficio,Bond,1 cara (frente),Bond 75g,2,200037
Impresión B/N,Oficio,Bond,2 caras (frente y atrás),Bond 75g,2,342120
Impresión B/N,Doble Carta,Bond,1 cara (frente),Bond 75g,2.8,264399
Impresión B/N,Doble Carta,Bond,2 caras (frente y atrás),Bond 75g,2.8,342441
Impresiones Color,Carta,Papel láser,1 cara (frente),Bond láser 105g,15.5,200057
Impresiones Color,Carta,Papel láser,2 caras (frente y atrás),Bond láser 105g,15.75,200057
Impresiones Color,Carta,Cartulina Opalina,1 cara (frente),Opalina 225g,18,200108
Impresiones Color,Carta,Cartulina Opalina,2 caras (frente y atrás),Opalina 225g,18,200108
Impresiones Color,Carta,Papel Couche Brillante,1 cara (frente),Couche 150g brillante,17.5,200097
Impresiones Color,Carta,Papel Couche Brillante,2 caras (frente y atrás),Couche 150g brillante,17.5,200097
Impresiones Color,Carta,Papel Couche Mate,1 cara (frente),Couche 150g mate,17.5,200102
Impresiones Color,Carta,Papel Couche Mate,2 caras (frente y atrás),Couche 150g mate,17.5,200102
Impresiones Color,Carta,Cartulina Couche Brillante,1 cara (frente),Couche 250g brillante,18,200071
Impresiones Color,Carta,Cartulina Couche Brillante,2 caras (frente y atrás),Couche 250g brillante,18,200071
Impresiones Color,Carta,Cartulina Couche Mate,1 cara (frente),Couche 250g mate,18,200107
Impresiones Color,Carta,Cartulina Couche Mate,2 caras (frente y atrás),Couche 250g mate,18,200107
Impresiones Color,Carta,Cartulina Kromecote,1 cara (frente),Kromecote 247g,19,200109
Impresiones Color,Carta,Couche Adhesivo,1 cara (frente),Couche Adhesivo 85g,19.5,200110
Impresiones Color,Carta,Cartulina Sulfatada,1 cara (frente),Sulfatada 12pts,18.5,231911
Impresiones Color,Carta,Acetato,1 cara (frente),Acetato láser 4mil,20,235248
Impresiones Color,Doble Carta,Papel láser,1 cara (frente),Bond láser 705g Tamaño Carta,19.5,200062
Impresiones Color,Doble Carta,Papel láser,2 caras (frente y atrás),Bond láser 705g Tamaño Carta,19.75,200062
Impresiones Color,Doble Carta,Cartulina Opalina,1 cara (frente),Opalina 225g Tamaño Doble Carta,22.5,200113
Impresiones Color,Doble Carta,Cartulina Opalina,2 caras (frente y atrás),Opalina 225g Tamaño Doble Carta,22.5,200113
Impresiones Color,Doble Carta,Papel Couche Brillante,1 cara (frente),Couche 150g mate,20,200103
Impresiones Color,Doble Carta,Papel Couche Brillante,2 caras (frente y atrás),Couche 150g mate,20,200103
Impresiones Color,Doble Carta,Papel Couche Mate,1 cara (frente),Couche 150g mate,20,200106
Impresiones Color,Doble Carta,Papel Couche Mate,2 caras (frente y atrás),Couche 150g mate,20,200106
Impresiones Color,Doble Carta,Cartulina Couche Brillante,1 cara (frente),Couche 250g brillante,23,200078
Impresiones Color,Doble Carta,Cartulina Couche Brillante,2 caras (frente y atrás),Couche 250g brillante,23,200078
Impresiones Color,Doble Carta,Cartulina Couche Mate,1 cara (frente),Couche 250g mate,23,200112
Impresiones Color,Doble Carta,Cartulina Couche Mate,2 caras (frente y atrás),Couche 250g mate,23,200112
Impresiones Color,Doble Carta,Cartulina Kromecote,1 cara (frente),Kromecote 247g,27,200114
Impresiones Color,Doble Carta,Couche Adhesivo,1 cara (frente),Couche Adhesivo 85g,29,200116
Impresiones Color,Doble Carta,Cartulina Sulfatada,1 cara (frente),Sulfatada 12pts,23,231912
Impresiones Color,Doble Carta,Folder Personalizado,1 cara (frente),Kromecote 247g,35,239826
Ploteo Color,90x60cm,Bond,,Recubierto Mate 140g,162.5,200043
Ploteo Color,90x60cm,Photoglossy,,Glossy 190g,253.5,200032
Ploteo Color,90x60cm,Aperlado,,Satin Aperlado 260g,253.5,208087
Ploteo Planos B/N,90x60cm,Bond,,Extra blanco 80g,32.5,200020
Ploteo Planos B/N,90x60cm,Albanene,,Calca Natural 90/95g,39,200028
Ploteo Planos Color,90x60cm,Bond,,Extra blanco 80g,97.5,220763
Ploteo Planos Color,90x60cm,Albanene,,Calca Natural 90/95g,104,335247
Ploteo Color,90x1.20cm,Bond,,Recubierto Mate 140g,312.5,200043
Ploteo Color,90x1.20cm,Photoglossy,,Glossy 190g,487.5,200032
Ploteo Color,90x1.20cm,Aperlado,,Satin Aperlado 260g,487.5,208087
Ploteo Planos B/N,90x1.20cm,Bond,,Extra blanco 80g,62.5,200020
Ploteo Planos B/N,90x1.20cm,Albanene,,Calca Natural 90/95g,75,200028
Ploteo Planos Color,90x1.20cm,Bond,,Extra blanco 80g,187.5,220763
Ploteo Planos Color,90x1.20cm,Albanene,,Calca Natural 90/95g,200,335247
Ploteo Color,60x45cm,Bond,,Recubierto Mate 140g,117.5,200043
Ploteo Color,60x45cm,Photoglossy,,Glossy 190g,180.5,200032
Ploteo Color,60x45cm,Aperlado,,Satin Aperlado 260g,180.5,208087
Ploteo Planos B/N,60x45cm,Bond,,Extra blanco 80g,27.5,200020
Ploteo Planos B/N,60x45cm,Albanene,,Calca Natural 90/95g,32,200028
Ploteo Planos Color,60x45cm,Bond,,Extra blanco 80g,72.5,220763
Ploteo Planos Color,60x45cm,Albanene,,Calca Natural 90/95g,77,335247
Impresión tarjetas,5.5x8.5cm,PVC,1 cara (frente),Tarjeta Blanca,20,329202
Impresión tarjetas,5.5x8.5cm,PVC,2 caras (frente y atrás),Tarjeta Blanca,35,329203
Ecuadernado,Flexible,Hasta 80 hojas,Transparente,Cubierta Flexible transparente A4,59,341222
Ecuadernado,Flexible,Hasta 120 hojas,Transparente,Cubierta Flexible transparente A4,69,341223
Ecuadernado,Flexible,Hasta 220 hojas,Transparente,Cubierta Flexible transparente A4,69,341224
Ecuadernado,Pasta Dura,Hasta 80 hojas,Negro,Cubierta Rigida A4,229,346498
Ecuadernado,Pasta Dura,Hasta 120 hojas,Negro,Cubierta Rigida A4,239,346499
Ecuadernado,Pasta Dura,Hasta 220 hojas,Negro,Cubierta Rigida A4,249,346500
Engargolado,Carta,Hasta 33 hojas,Arena Negro,Polipropileno 16 puntos,24,343268
Engargolado,Carta,Hasta 44 hojas,Arena Negro,Polipropileno 16 puntos,24,343268
Engargolado,Carta,Hasta 67 hojas,Arena Negro,Polipropileno 16 puntos,24,343268
Engargolado,Carta,Hasta 86 hojas,Arena Negro,Polipropileno 16 puntos,24,343268
Engargolado,Carta,Hasta 105 hojas,Arena Negro,Polipropileno 16 puntos,29.5,343268
Engargolado,Carta,Hasta 122 hojas,Arena Negro,Polipropileno 16 puntos,29.5,343268
Engargolado,Carta,Hasta 147 hojas,Arena Negro,Polipropileno 16 puntos,29.5,343268
Engargolado,Carta,Hasta 169 hojas,Arena Negro,Polipropileno 16 puntos,29.5,343268
Engargolado,Carta,Hasta 190 hojas,Arena Negro,Polipropileno 16 puntos,35,343268
Engargolado,Carta,Hasta 257 hojas,Arena Negro,Polipropileno 16 puntos,41,343268
Engargolado,Doble Carta,Hasta 33 hojas,Arena Negro,Polipropileno 16 puntos,33,343273
Engargolado,Doble Carta,Hasta 44 hojas,Arena Negro,Polipropileno 16 puntos,33,343273
Engargolado,Doble Carta,Hasta 67 hojas,Arena Negro,Polipropileno 16 puntos,33,343273
Engargolado,Doble Carta,Hasta 86 hojas,Arena Negro,Polipropileno 16 puntos,33,343273
Engargolado,Doble Carta,Hasta 105 hojas,Arena Negro,Polipropileno 16 puntos,38.5,343273
Engargolado,Doble Carta,Hasta 122 hojas,Arena Negro,Polipropileno 16 puntos,38.5,343273
Engargolado,Doble Carta,Hasta 147 hojas,Arena Negro,Polipropileno 16 puntos,38.5,343273
Engargolado,Doble Carta,Hasta 169 hojas,Arena Negro,Polipropileno 16 puntos,38.5,343273
Engargolado,Doble Carta,Hasta 190 hojas,Arena Negro,Polipropileno 16 puntos,44,343273
Engargolado,Doble Carta,Hasta 257 hojas,Arena Negro,Polipropileno 16 puntos,50,343273
Taza,,,Blanca,Ceramica 15oz,85,220266
Taza,,,Negra Magica,Vidrio 15oz,109,220267
MousPad,,,,Neopreno rectangular 22 cm x 18 cm,59,220269
Rompecabezas,,,,Polimero A4 120 piezas,75,220268
Botella Aluminio,,,Blanca,400mil,175,341982
Piedra,,,,Decorativa sublimable,249,341984
Taza Cónica,,,Blanca,Ceramica 17oz,129,341985
Thermo Bala,,,Blanco,500ml,499,350603
Vaso Acero,,,Blanco,600ml,599,350606
Botón Publicitario 2 1/4,,,Sencillo (12 piezas),5.5cm,85,339833
Botón Publicitario 2 1/4,,,con destapador (6 piezas),5.5cm,115,341981`;
                    try {
                        const rows = csvData.split('\n').map(row => row.trim());
                        this.configDB = rows.map(row => {
                            const cols = row.split(',');
                            const precioString = (cols[5] || '0').trim();
                            const precioNum = parseFloat(precioString) || 0;
                            const noAplica = 'No aplica';
                            return {
                                servicio: cols[0]?.trim() || noAplica,
                                material: cols[1]?.trim() || noAplica,
                                producto: cols[2]?.trim() || noAplica,
                                caras: cols[3]?.trim() || noAplica,
                                detalles: cols[4]?.trim() || noAplica,
                                precio: precioNum,
                                codigo: cols[6]?.trim() || ''
                            };
                        }).filter(item => item.servicio);
                        this.dataLoaded = true;
                        console.log('Datos de configuración cargados localmente.', this.configDB.length, 'filas.');
                        // Calcular precios base mínimos desde configDB
                        Object.keys(this.serviceMap).forEach(slug => {
                            const service = this.serviceMap[slug];
                            const prices = this.configDB.filter(item => item.servicio === service).map(item => item.precio).filter(p => p > 0);
                            if (prices.length > 0) {
                                const minPrice = Math.min(...prices).toFixed(2);
                                allProducts[slug].price = minPrice;
                            }
                        });
                    } catch (error) {
                         console.error('Error al parsear los datos locales:', error);
                         this.dataError = 'Error interno al procesar los datos del producto.';
                    }
                    this.handleHashChange();
                    this.$nextTick(() => this.checkTimeAndDisplay());
                    // Revisar cada minuto para actualizar si el usuario deja la página abierta
                    setInterval(() => this.checkTimeAndDisplay(), 60000);
                    // Recalcular en resize
                    window.addEventListener('resize', () => this.checkTimeAndDisplay());
                    // Asegurar ajuste en load completo
                    window.addEventListener('load', () => this.checkTimeAndDisplay());
                    // Ajuste inicial con delay para rendering
                    setTimeout(() => this.checkTimeAndDisplay(), 100);
                    // Chequear descuento viernes con dismiss
                    if (this.isFriday && !sessionStorage.getItem('dismissedFriday')) {
                        document.getElementById('friday-notification').classList.remove('hidden');
                    } else {
                        document.getElementById('friday-notification').classList.add('hidden');
                    }
                }
            };
        }
        document.addEventListener('alpine:init', () => {
            Alpine.data('app', app);
            Alpine.data('carousel', carousel);
        });
    </script>
</head>
<body x-data="app()" x-init="init()" @hashchange.window="handleHashChange()" x-cloak class="font-sans antialiased bg-gray-100">
    <header x-data="{ scrolled: false, open: false }"
            :class="{ 'fixed top-0 left-0 right-0 z-50 bg-white shadow-lg': true }"
            class="w-full z-50 transition-all duration-300 appear-animate" style="animation-delay: 0.1s;">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20 md:h-20">
                <div class="flex items-center space-x-4 md:space-x-8">
                    <a @click.prevent="goHome()" href="#" class="flex-shrink-0">
                        <img class="h-16 md:h-16 w-auto" src="/docs/logo-impresiones-lumen" alt="Lumen Logo">
                    </a>
                    <div class="hidden lg:flex space-x-4">
                        <div x-show="hasImpresiones()" class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="text-gray-700 hover:text-lumen-blue font-medium inline-flex items-center">
                                Impresión y Ploteo
                                <svg class="ml-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                            <div x-show="open" x-transition class="absolute left-0 mt-2 w-96 bg-white rounded-md shadow-lg z-50 ring-1 ring-black ring-opacity-5" style="display: none;">
                                <div class="py-1">
                                    <template x-for="prod in filteredImpresiones()" :key="prod.id_slug">
                                        <a @click.prevent="showProduct(prod.id_slug)" href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-lumen-blue" x-text="prod.name"></a>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <div x-show="hasPromocionales()" class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="text-gray-700 hover:text-lumen-blue font-medium inline-flex items-center">
                                Acabados y Promocionales
                                <svg class="ml-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                            <div x-show="open" x-transition class="absolute left-0 mt-2 w-96 bg-white rounded-md shadow-lg z-50 ring-1 ring-black ring-opacity-5" style="display: none;">
                                <div class="py-1">
                                    <template x-for="prod in filteredPromocionales()" :key="prod.id_slug">
                                        <a @click.prevent="showProduct(prod.id_slug)" href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-lumen-blue" x-text="prod.name"></a>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <div x-show="hasSublimados()" class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="text-gray-700 hover:text-lumen-blue font-medium inline-flex items-center">
                                Sublimados
                                <svg class="ml-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                            <div x-show="open" x-transition class="absolute left-0 mt-2 w-96 bg-white rounded-md shadow-lg z-50 ring-1 ring-black ring-opacity-5" style="display: none;">
                                <div class="py-1">
                                    <template x-for="prod in filteredSublimados()" :key="prod.id_slug">
                                        <a @click.prevent="showProduct(prod.id_slug)" href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-lumen-blue" x-text="prod.name"></a>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-2 md:space-x-4">
                    <div class="flex flex-col items-center hidden md:flex">
                        <button @click="showSucursalModal = true; tempSuc = selectedSucursal" class="text-sm text-lumen-red bg-white border border-lumen-red py-1 px-3 rounded-full hover:bg-lumen-red hover:text-lumen-blue hover:shadow-md">Cambiar sucursal</button>
                        <span class="text-xs text-gray-500 mt-1" x-text="selectedSucursal || 'Ninguna seleccionada'"></span>
                        <template x-if="selectedSucursal">
                            <a :href="sucursalesInfo[selectedSucursal].mapsLink" target="_blank" class="text-xs text-lumen-blue underline hover:text-lumen-red">Ver dirección en Maps</a>
                        </template>
                    </div>
                    <a @click.prevent="showCart()" href="#" class="relative p-2 text-gray-600 hover:text-lumen-blue flex items-center">
                        <svg class="h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 000-4zm4 0z" /></svg>
                        <span class="ml-1 text-sm font-medium">Mi carrito</span>
                        <span x-show="cart.length > 0" class="absolute top-0 right-0 block h-5 w-5 -mt-1 -mr-1 text-xs text-white bg-lumen-red rounded-full flex items-center justify-center" x-text="cart.length"></span>
                    </a>
                    <button @click="open = !open" class="md:hidden p-2 text-gray-600 hover:text-lumen-blue" aria-label="Abrir menú">
                        <svg x-show="!open" class="h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                        <svg x-show="open" class="h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="display: none;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
            <div x-show="open" x-transition @click.away="open = false" class="md:hidden" style="display: none;">
                <div class="py-4 px-5 overflow-y-auto max-h-[80vh]">
                    <template x-if="hasImpresiones()">
                        <div>
                            <h3 class="font-semibold text-gray-500 uppercase text-xs mb-2">Impresión y Ploteo</h3>
                            <template x-for="prod in filteredImpresiones()" :key="prod.id_slug">
                                <a @click.prevent="showProduct(prod.id_slug); open = false" href="#" class="block py-2 px-3 rounded-md text-sm text-gray-700 hover:bg-gray-100 hover:text-lumen-blue" x-text="prod.name"></a>
                            </template>
                        </div>
                    </template>
                    <div class="border-t my-4"></div>
                    <template x-if="hasPromocionales()">
                        <div>
                            <h3 class="font-semibold text-gray-500 uppercase text-xs mb-2">Acabados y Promocionales</h3>
                            <template x-for="prod in filteredPromocionales()" :key="prod.id_slug">
                                <a @click.prevent="showProduct(prod.id_slug); open = false" href="#" class="block py-2 px-3 rounded-md text-sm text-gray-700 hover:bg-gray-100 hover:text-lumen-blue" x-text="prod.name"></a>
                            </template>
                        </div>
                    </template>
                    <div class="border-t my-4"></div>
                    <template x-if="hasSublimados()">
                        <div>
                            <h3 class="font-semibold text-gray-500 uppercase text-xs mb-2">Sublimados</h3>
                            <template x-for="prod in filteredSublimados()" :key="prod.id_slug">
                                <a @click.prevent="showProduct(prod.id_slug); open = false" href="#" class="block py-2 px-3 rounded-md text-sm text-gray-700 hover:bg-gray-100 hover:text-lumen-blue" x-text="prod.name"></a>
                            </template>
                        </div>
                    </template>
                    <div class="border-t my-4"></div>
                    <div class="flex flex-col space-y-4 items-start">
                        <button @click="showSucursalModal = true; tempSuc = selectedSucursal; open = false" class="text-sm text-lumen-red bg-white border border-lumen-red py-1 px-3 rounded-full hover:bg-lumen-red hover:text-lumen-blue hover:shadow-md">Cambiar sucursal</button>
                        <span class="text-xs text-gray-500" x-text="selectedSucursal || 'Ninguna seleccionada'"></span>
                        <template x-if="selectedSucursal">
                            <a :href="sucursalesInfo[selectedSucursal].mapsLink" target="_blank" class="text-xs text-lumen-blue underline hover:text-lumen-red">Ver dirección en Maps</a>
                        </template>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main class="pt-16 md:pt-24">
        <!-- MODAL SUCURSAL -->
        <div x-show="showSucursalModal" @keydown.escape.window="showSucursalModal = false" class="fixed inset-0 z-50 flex items-center justify-center" style="display: none;">
            <div x-show="showSucursalModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="absolute inset-0 bg-black bg-opacity-50"></div>
            <div x-show="showSucursalModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 scale-90" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-90"
                 @click.away="showSucursalModal = false"
                 class="relative bg-white w-full max-w-md p-6 rounded-lg shadow-xl m-4">
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-3">Elige tu sucursal</h2>
                    <p class="text-gray-600 mb-6">Selecciona una sucursal para ver los servicios disponibles allí.</p>
                    <select x-model="tempSuc" class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue mb-4">
                        <option value="">Selecciona...</option>
                        <template x-for="s in sucursales" :key="s">
                            <option :value="s" x-text="s"></option>
                        </template>
                    </select>
                    <button @click="selectSucursal()" :disabled="!tempSuc" class="w-full text-center bg-lumen-red text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-red-700 transition duration-300 disabled:opacity-50">
                        Confirmar
                    </button>
                </div>
            </div>
        </div>
        <!-- HOME -->
        <div x-show="view === 'home'" x-transition:leave="transition ease-in duration-150" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
            <section class="bg-gray-50 appear-animate" style="animation-delay: 0.2s;">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24">
                    <div class="flex flex-col md:flex-row items-center">
                        <div class="w-full md:w-1/2 text-center md:text-left mb-12 md:mb-0">
                            <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-lumen-blue leading-tight mb-6">
                                Impresiones que impresionan
                            </h1>
                            <p class="text-lg text-gray-600 mb-8 max-w-lg mx-auto md:mx-0">
                                Entendemos que cada proyecto es único y merece una atención especial. Calidad y rapidez en cada hoja.
                            </p>
                            <a @click.prevent="showProduct('impresion-color')" href="#" class="inline-block bg-lumen-red text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-red-700 transition duration-300 transform hover:scale-105">
                                Crear Ahora
                            </a>
                        </div>
                        <div class="w-full md:w-1/2 relative">
                            <div class="aspect-w-16 aspect-h-9 rounded-2xl overflow-hidden shadow-2xl">
                                <img src="https://images.pexels.com/photos/193057/pexels-photo-193057.jpeg" alt="Impresiones de proyectos" class="object-cover w-full h-full">
                            </div>
                            <img src="https://images.pexels.com/photos/1942489/pexels-photo-1942489.jpeg" alt="polaroid" class="absolute -bottom-10 -left-10 w-32 rounded-lg shadow-lg transform -rotate-12 hidden lg:block">
                            <img src="https://images.pexels.com/photos/1207918/pexels-photo-1207918.jpeg" alt="taza" class="absolute -bottom-16 right-10 w-40 rounded-full shadow-lg hidden lg:block">
                        </div>
                    </div>
                </div>
            </section>
            <section class="py-16 bg-white appear-animate" style="animation-delay: 0.3s;" x-data="carousel()">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <h2 class="text-3xl font-bold text-center text-lumen-blue mb-12">Descubre nuestros Servicios</h2>
                    <div class="relative">
                        <div class="overflow-hidden">
                            <div class="overflow-x-auto no-scrollbar" x-ref="slider">
                                <div class="flex space-x-6 md:space-x-8 pb-4 px-4 sm:px-0">
                                    <template x-for="prod in filteredProducts().slice(0, 5)" :key="prod.id_slug">
                                        <a @click.prevent="showProduct(prod.id_slug)" href="#" class="flex-shrink-0 group text-center w-40">
                                            <div class="w-32 h-32 mx-auto rounded-full bg-gray-200 overflow-hidden shadow-md transform group-hover:scale-110 group-hover:shadow-lg transition-all duration-300">
                                                <img :src="prod.img" :alt="prod.name" class="w-full h-full object-cover">
                                            </div>
                                            <h3 class="mt-4 font-semibold text-gray-700 group-hover:text-lumen-blue" x-text="prod.name"></h3>
                                        </a>
                                    </template>
                                    <div class="flex-shrink-0 w-1"></div>
                                </div>
                            </div>
                        </div>
                        <button @click="scrollLeft()" class="absolute top-1/2 left-0 -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100 transition z-10 md:-ml-4 hidden md:flex">
                            <svg class="w-6 h-6 text-lumen-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                            </svg>
                        </button>
                        <button @click="scrollRight()" class="absolute top-1/2 right-0 -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100 transition z-10 md:-mr-4 hidden md:flex">
                            <svg class="w-6 h-6 text-lumen-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                            </svg>
                        </button>
                    </div>
                </div>
            </section>
            <section class="py-16 bg-gray-50 appear-animate" style="animation-delay: 0.4s;">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <h2 class="text-3xl font-bold text-center text-lumen-blue mb-8">Nuestros Servicios</h2>
                    <div class="flex flex-wrap justify-center gap-3 md:gap-4 mb-12">
                        <button @click="filter = 'todo'" :class="filter === 'todo' ? 'filter-btn-active' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'" class="px-6 py-2 font-semibold border rounded-full shadow-sm transition-all duration-300">Todo</button>
                        <button @click="filter = 'impresiones'" :class="filter === 'impresiones' ? 'filter-btn-active' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'" class="px-6 py-2 font-semibold border rounded-full shadow-sm transition-all duration-300">Impresiones</button>
                        <button @click="filter = 'promocionales'" :class="filter === 'promocionales' ? 'filter-btn-active' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'" class="px-6 py-2 font-semibold border rounded-full shadow-sm transition-all duration-300">Promocionales</button>
                        <button @click="filter = 'sublimados'" :class="filter === 'sublimados' ? 'filter-btn-active' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'" class="px-6 py-2 font-semibold border rounded-full shadow-sm transition-all duration-300">Sublimados</button>
                    </div>
                    <div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
                            <template x-for="prod in filteredProducts()" :key="prod.id_slug">
                                <div x-show="filter === 'todo' || filter === prod.category" class="bg-white rounded-lg shadow-lg overflow-hidden transition-all duration-300 transform hover:scale-105" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform scale-90" x-transition:enter-end="opacity-100 transform scale-100" style="display: none;">
                                    <a @click.prevent="showProduct(prod.id_slug)" href="#" class="block">
                                        <img class="w-full h-56 object-cover" :src="prod.img" :alt="prod.name">
                                    </a>
                                    <div class="p-5">
                                        <h3 class="font-semibold text-lg text-gray-800 truncate" x-text="prod.name"></h3>
                                        <p class="text-lumen-red font-bold text-xl mt-2" x-text="'Desde $' + prod.price"></p>
                                        <a @click.prevent="showProduct(prod.id_slug)" href="#" class="mt-4 block w-full text-center bg-lumen-blue text-white py-2 px-4 rounded-md font-semibold hover:bg-blue-900 transition-colors">Ver servicio</a>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </section>
            <section class="py-16 bg-white appear-animate" style="animation-delay: 0.5s;">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <h2 class="text-3xl font-bold text-center text-lumen-blue mb-12">Comprometidos con un servicio de calidad</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10">
                        <div class="text-center">
                            <div class="w-20 h-20 mx-auto border-2 border-lumen-blue rounded-full flex items-center justify-center mb-4"><svg class="w-10 h-10 text-lumen-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg></div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">Recoge en tienda</h3>
                            <p class="text-gray-600">¡Imprime hoy y recógelo hoy mismo!</p>
                        </div>
                        <div class="text-center">
                            <div class="w-20 h-20 mx-auto border-2 border-lumen-blue rounded-full flex items-center justify-center mb-4"><svg class="w-10 h-10 text-lumen-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg></div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">Pago seguro</h3>
                            <p class="text-gray-600">Tus datos están protegidos.</p>
                        </div>
                        <div class="text-center">
                            <div class="w-20 h-20 mx-auto border-2 border-lumen-blue rounded-full flex items-center justify-center mb-4"><svg class="w-10 h-10 text-lumen-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg></div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">100% Seguro</h3>
                            <p class="text-gray-600">Garantía de calidad en cada impresión.</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <!-- DETAIL -->
        <div x-show="view === 'detail'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
            <template x-if="currentProduct">
                <section class="container mx-auto px-4 sm:px-6 lg:px-8 my-12">
                    <div class="bg-white p-6 md:p-10 rounded-lg shadow-xl">
                        <div class="flex flex-col md:grid md:grid-cols-2 gap-10 md:gap-16">
                            <div class="order-1 md:order-1">
                                <div class="border rounded-lg overflow-hidden mb-4">
                                    <img :src="currentProduct.img" alt="Imagen principal del producto" class="w-full h-auto object-cover aspect-square">
                                </div>
                                <div class="flex space-x-3 overflow-x-auto">
                                    <template x-for="thumb in currentProduct.thumbnails" :key="thumb">
                                        <button class="border-2 rounded-md overflow-hidden focus:outline-none focus:border-lumen-blue">
                                            <img :src="thumb" alt="Thumbnail" class="w-20 h-20 object-cover">
                                        </button>
                                    </template>
                                </div>
                            </div>
                            <div class="order-2 md:order-2">
                                <button @click="goHome()" class="text-sm text-lumen-blue underline hover:text-lumen-red mb-4">&lt; Volver a todos los productos</button>
                                <h1 class="text-3xl md:text-4xl font-bold text-lumen-blue mb-3" x-text="currentProduct.name"></h1>
                                <div class="mb-6">
                                    <span class="text-gray-500 text-lg">Desde:</span>
                                    <span class="text-4xl font-extrabold text-lumen-red ml-2" x-text="'$' + currentProduct.price"></span>
                                </div>
                                <div class="mb-8">
                                    <button @click="showConfig()"
                                            :disabled="!dataLoaded"
                                            :class="{ 'opacity-50 cursor-not-allowed': !dataLoaded, 'hover:bg-red-700 hover:scale-105': dataLoaded }"
                                            class="w-full md:w-auto inline-block text-center bg-lumen-red text-white font-bold py-4 px-12 rounded-full text-lg shadow-lg transition duration-300 transform">
                                        <span x-show="dataLoaded">Configurar Servicio</span>
                                        <span x-show="!dataLoaded" class="animate-pulse">Cargando opciones...</span>
                                    </button>
                                </div>
                                <div class="mb-8">
                                    <h3 class="text-xl font-bold text-lumen-blue mb-4 border-b pb-2">Disponibilidad en Sucursales</h3>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-gray-700">
                                        <template x-for="sucursal in currentProduct.sucursalesDisponibles" :key="sucursal">
                                            <div class="text-sm" x-text="sucursal"></div>
                                        </template>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-lumen-blue mb-4 border-b pb-2">Acerca del producto</h3>
                                    <ul class="list-disc list-inside space-y-2 text-gray-700">
                                        <template x-for="point in currentProduct.description" :key="point">
                                            <li x-text="point"></li>
                                        </template>
                                    </ul>
                                    <p class="text-lumen-red font-bold mt-4">Nota importante: Los archivos PDF subidos deben estar ya configurados al tamaño final de impresión, ya que no realizaremos ajustes adicionales.</p>
                                </div>
                                <div class="mt-4 bg-blue-50 border-l-4 border-lumen-blue p-4 rounded-lg">
                                    <p class="text-sm font-semibold text-lumen-blue">
                                        Una vez hecho el pedido, se entregará en un lapso de 1 a 2 horas y será notificado vía correo.
                                    </p>
                                </div>
                                <div class="mt-8 bg-gray-50 p-4 rounded-lg border">
                                    <p class="text-sm text-gray-700 font-semibold">
                                        Al finalizar el proceso te enviaremos una liga de pago (Tarjeta, transferencia o depósito).
                                    </p>
                                    <p class="text-sm text-gray-600 mt-1">
                                        No se entregará el pedido hasta corroborar el pago.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </template>
        </div>
        <!-- CONFIG -->
        <div x-show="view === 'config'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
            <template x-if="currentProduct">
                <section class="container mx-auto px-4 sm:px-6 lg:px-8 my-12">
                    <div class="bg-white p-6 md:p-10 rounded-lg shadow-xl max-w-6xl mx-auto">
                        <button @click="showDetail()" class="text-sm text-lumen-blue underline hover:text-lumen-red mb-6">&lt; Volver al detalle</button>
                        <h1 class="text-3xl font-bold text-lumen-blue mb-6 border-b pb-4">Configura tu <span x-text="currentProduct.name"></span></h1>
                        <template x-if="dataError">
                            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                                <strong class="font-bold">Error: </strong>
                                <span class="block sm:inline" x-text="dataError"></span>
                            </div>
                        </template>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                            <!-- VISOR PDF CON IFRAME -->
                            <div class="w-full space-y-6">
                                <h2 class="text-xl font-semibold text-gray-800">Sube tu archivo</h2>
                                <div x-show="!pdf.file">
                                    <label for="fileInput"
                                           class="pdf-uploader"
                                           :class="{ 'dragover': pdf.isDragOver }"
                                           @dragover.prevent="pdf.isDragOver = true"
                                           @dragleave.prevent="pdf.isDragOver = false"
                                           @drop.prevent="handleFileDrop($event)">
                                        <svg class="w-12 h-12" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" />
                                        </svg>
                                        <h3>Haz clic o arrastra un archivo PDF</h3>
                                        <p>El archivo no debe pesar más de 100 MB.</p>
                                        <span class="pdf-uploader-btn">Seleccionar archivo</span>
                                    </label>
                                    <input id="fileInput" type="file" @change="handleFileSelect($event)" accept="application/pdf" class="hidden">
                                    <template x-if="pdf.error">
                                        <p class="text-sm text-red-600 mt-2" x-text="pdf.error"></p>
                                    </template>
                                </div>
                                <div x-show="pdf.file" class="pdf-viewer-wrap">
                                    <div class="pdf-viewer-toolbar">
                                        <div class="font-medium text-gray-700" x-text="pdf.fileName"></div>
                                        <div class="flex items-center gap-2">
                                            <span x-text="'Páginas: ' + pdf.numPages"></span>
                                        </div>
                                        <button @click="clearPdfViewer()" class="text-sm text-lumen-red underline hover:text-red-700">Quitar</button>
                                    </div>
                                    <div class="bg-gray-100 h-[70vh] overflow-auto flex justify-center flex-col p-4">
                                        <iframe :src="pdf.previewSrc" style="width: 100%; height: 100%;"></iframe>
                                    </div>
                                </div>
                                <template x-if="currentProduct.id_slug.includes('color')">
                                    <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative" role="alert">
                                        <strong class="font-bold">Advertencia: </strong>
                                        <span class="block sm:inline">Se recomienda que tu archivo PDF esté en formato CMYK para evitar variaciones en los colores al imprimir. (RGB puede causar diferencias en el resultado final).</span>
                                    </div>
                                </template>
                                <template x-if="currentProduct.category === 'impresiones' || currentProduct.id_slug === 'ecuadernado' || currentProduct.id_slug === 'engargolado'">
                                    <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative" role="alert">
                                        <strong class="font-bold">Advertencia: </strong>
                                        <span class="block sm:inline">No imprimimos archivos con derechos de autor, como libros o material protegido. Si se detecta, el archivo y el pedido serán cancelados automáticamente.</span>
                                    </div>
                                </template>
                            </div>
                            <div class="w-full space-y-6">
                                <h2 class="text-xl font-semibold text-gray-800">Elige tus opciones</h2>
                                <template x-if="currentProduct.id_slug === 'ecuadernado'">
                                    <h3 class="text-lg font-bold text-lumen-blue">Configuración de Pasta Dura/Flex</h3>
                                </template>
                                <template x-if="currentProduct.id_slug === 'engargolado'">
                                    <h3 class="text-lg font-bold text-lumen-blue">Configuración de Engargolado</h3>
                                </template>
                                <template x-if="!['engargolado', 'ecuadernado'].includes(currentProduct.id_slug)">
                                    <h3 class="text-lg font-bold text-lumen-blue">Opciones de Impresión</h3>
                                </template>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">1. Selecciona el tamaño o formato</label>
                                    <select x-model="configState.material"
                                            @change="updateConfigOptions('material')"
                                            class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                        <option value="">Selecciona...</option>
                                        <template x-for="opt in available.materiales" :key="opt">
                                            <option :value="opt" x-text="opt"></option>
                                        </template>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">2. Elige el tipo o material</label>
                                    <select x-model="configState.producto"
                                            @change="updateConfigOptions('producto')"
                                            :disabled="configState.material === ''"
                                            :class="{ 'select-disabled': configState.material === '' }"
                                            class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                        <option value="">Selecciona...</option>
                                        <template x-for="opt in available.productos" :key="opt">
                                            <option :value="opt" x-text="opt"></option>
                                        </template>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">3. Opciones de impresión o estilo</label>
                                    <select x-model="configState.caras"
                                            @change="updateConfigOptions('caras')"
                                            :disabled="configState.producto === ''"
                                            :class="{ 'select-disabled': configState.producto === '' }"
                                            class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                        <option value="">Selecciona...</option>
                                        <template x-for="opt in available.caras" :key="opt">
                                            <option :value="opt" x-text="opt"></option>
                                        </template>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">4. Detalles adicionales o acabado</label>
                                    <select x-model="configState.detalles"
                                            @change="findPrice()"
                                            :disabled="configState.caras === ''"
                                            :class="{ 'select-disabled': configState.caras === '' }"
                                            class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                        <option value="">Selecciona...</option>
                                        <template x-for="opt in available.detalles" :key="opt">
                                            <option :value="opt" x-text="opt"></option>
                                        </template>
                                    </select>
                                </div>
                                <!-- TIPO DE IMPRESIÓN -->
                                <template x-if="['engargolado', 'ecuadernado'].includes(currentProduct.id_slug)">
                                    <div>
                                        <h3 class="text-lg font-bold text-lumen-blue">Configuración de Impresiones</h3>
                                        <label class="block text-sm font-medium text-gray-700 mb-1 mt-4">5. Tipo de Impresión</label>
                                        <select x-model="configState.impresionType" @change="findPrice()" class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                            <option value="bn">B/N</option>
                                            <option value="color">Color</option>
                                        </select>
                                    </div>
                                </template>
                                <div x-show="['engargolado', 'ecuadernado'].includes(currentProduct.id_slug) && configState.impresionType !== 'none'">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">6. Caras de Impresión</label>
                                    <select x-model="configState.impresionCaras" @change="findPrice()" class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                        <option value="1 cara (frente)">Frente (1 cara)</option>
                                        <option value="2 caras (frente y atrás)">Frente y Atrás (2 caras)</option>
                                    </select>
                                </div>
                                <!-- MENSAJE BOND 75g -->
                                <template x-if="['engargolado', 'ecuadernado'].includes(currentProduct.id_slug) && configState.impresionType !== 'none'">
                                    <div class="bg-blue-50 border-l-4 border-lumen-blue p-4 rounded-lg mt-4">
                                        <p class="font-bold text-lumen-blue">
                                            Las impresiones internas se realizarán en hojas de papel Bond 75g.
                                        </p>
                                    </div>
                                </template>
                                <div x-show="currentProduct && currentProduct.requiresPageRange">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">7. Rango de Hojas</label>
                                    <input type="text" x-model="configState.pageRange" @input.debounce.500ms="findPrice()" class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue" placeholder="ej. 1-10, 15, 20-22 (deja vacío = todo)">
                                    <div class="text-sm text-gray-600 mt-1">
                                        <template x-if="configState.pageRange.trim() !== ''">
                                            Páginas seleccionadas: <strong x-text="parsePageRange(configState.pageRange)"></strong>
                                        </template>
                                        <template x-else>
                                            Se imprimirán todas las páginas: <strong x-text="pdf.numPages || '0'"></strong>
                                        </template>
                                    </div>
                                </div>
                                <div x-show="['Impresión B/N', 'Impresiones Color', 'Engargolado'].includes(currentProduct.name)">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Orientación</label>
                                    <select x-model="configState.orientacion" @change="findPrice()" class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                        <option value="">Selecciona...</option>
                                        <option value="Horizontal">Horizontal</option>
                                        <option value="Vertical">Vertical</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cantidad (Juegos)</label>
                                    <input type="number" x-model.number="configState.cantidad" min="1" class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue" placeholder="1">
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg mt-6">
                                    <h3 class="font-semibold text-lg text-lumen-blue">Resumen del Servicio</h3>
                                    <div class="mt-2 text-sm text-gray-600 space-y-1">
                                        <p><strong>Detalle:</strong> <span x-text="configState.finalDetail || '---'"></span></p>
                                        <p><strong>Páginas a imprimir:</strong> <span x-text="parsePageRange(configState.pageRange) || pdf.numPages || '0'"></span></p>
                                        <p><strong>Código:</strong> <span x-text="configState.finalCode || '---'"></span></p>
                                    </div>
                                    <div class="mt-4">
                                        <span class="text-gray-700 font-medium">Precio por unidad (juego):</span>
                                        <span class="text-2xl font-bold text-lumen-red ml-2" x-text="configState.finalPrice > 0 ? '$' + configState.finalPrice.toFixed(2) : '$0.00'"></span>
                                    </div>
                                    <div class="mt-2 border-t pt-2">
                                        <span class="text-gray-800 font-bold text-lg">Total:</span>
                                        <span class="text-3xl font-extrabold text-lumen-red ml-2" x-text="'$' + (configState.finalPrice * configState.cantidad).toFixed(2)"></span>
                                    </div>
                                </div>
                                <template x-if="configState.errorMessage">
                                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                                        <span class="block sm:inline" x-text="configState.errorMessage"></span>
                                    </div>
                                </template>
                                <button @click="configState.editingItemId ? updateCartItem() : addToCart()"
                                        class="w-full text-center bg-lumen-red text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-red-700 transition duration-300">
                                    <span x-show="!configState.editingItemId">Añadir al Carrito</span>
                                    <span x-show="configState.editingItemId">Actualizar Item</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </template>
        </div>
        <!-- CARRITO -->
        <div x-show="view === 'cart'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
            <section class="container mx-auto px-4 sm:px-6 lg:px-8 my-12">
                <div class="max-w-4xl mx-auto">
                    <h1 class="text-3xl font-bold text-lumen-blue mb-8">Mi Carrito</h1>
                    <template x-if="cart.length === 0">
                        <div class="bg-white p-10 rounded-lg shadow-xl text-center">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Tu carrito está vacío</h2>
                            <p class="text-gray-500 mb-6">Parece que aún no has añadido ningún servicio.</p>
                            <button @click="goHome()" class="inline-block bg-lumen-blue text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-blue-900 transition duration-300">
                                Ver servicios
                            </button>
                        </div>
                    </template>
                    <template x-if="cart.length > 0">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div class="lg:col-span-2 space-y-6">
                                <div class="bg-white p-6 rounded-lg shadow-xl space-y-6">
                                    <template x-for="item in cart" :key="item.id">
                                        <div class="flex flex-col sm:flex-row gap-4 border-b pb-6 last:border-b-0 last:pb-0">
                                            <img :src="item.img" alt="" class="w-full sm:w-32 h-32 object-cover rounded-md flex-shrink-0">
                                            <div class="flex-grow">
                                                <h3 class="text-lg font-semibold text-lumen-blue" x-text="item.productName"></h3>
                                                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                                                    <li x-show="item.config.material && item.config.material !== 'No aplica'"><strong class="capitalize">Material:</strong> <span x-text="item.config.material"></span></li>
                                                    <li x-show="item.config.producto && item.config.producto !== 'No aplica'"><strong class="capitalize">Producto:</strong> <span x-text="item.config.producto"></span></li>
                                                    <li x-show="item.config.caras && item.config.caras !== 'No aplica'"><strong class="capitalize">Caras:</strong> <span x-text="item.config.caras"></span></li>
                                                    <li x-show="item.config.detalles && item.config.detalles !== 'No aplica'"><strong class="capitalize">Detalles:</strong> <span x-text="item.config.detalles"></span></li>
                                                    <li x-show="item.config.pageRange"><strong class="capitalize">Rango Hojas:</strong> <span x-text="item.config.pageRange"></span></li>
                                                    <li x-show="item.config.orientacion"><strong class="capitalize">Orientación:</strong> <span x-text="item.config.orientacion"></span></li>
                                                    <li x-show="item.config.impresionType && item.config.impresionType !== 'none'"><strong class="capitalize">Tipo Impresión:</strong> <span x-text="item.config.impresionType === 'bn' ? 'B/N' : 'Color'"></span></li>
                                                    <li x-show="item.config.impresionCaras"><strong class="capitalize">Caras Impresión:</strong> <span x-text="item.config.impresionCaras === '1 cara (frente)' ? 'Frente' : 'Frente y Atrás'"></span></li>
                                                    <li x-show="item.config.extraArillo"><strong class="capitalize">Arillo Extra:</strong> Sí (+$16)</li>
                                                    <li x-show="item.file"><strong class="capitalize">Archivo:</strong> <span x-text="item.file.name"></span></li>
                                                </ul>
                                            </div>
                                            <div class="flex-shrink-0 text-left sm:text-right">
                                                <p class="text-lg font-bold text-lumen-red" x-text="'$' + (item.price * item.cantidad).toFixed(2)"></p>
                                                <p class="text-sm text-gray-500 mb-2" x-text="'Cant: ' + item.cantidad"></p>
                                                <button @click="editCartItem(item.id)" class="text-sm text-lumen-blue underline hover:text-lumen-red hover:no-underline font-semibold mr-3">Editar</button>
                                                <button @click="removeFromCart(item.id)" class="text-sm text-red-600 underline hover:text-lumen-red hover:no-underline font-semibold">Quitar</button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-xl space-y-4">
                                    <h2 class="text-xl font-bold text-lumen-blue mb-4">Datos de quien recoge</h2>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Nombre completo</label>
                                        <input type="text" x-model="customer.name" class="mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue" placeholder="Tu nombre">
                                        <template x-if="formErrors.name"><p class="text-sm text-red-600 mt-1" x-text="formErrors.name"></p></template>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Email</label>
                                        <input type="email" x-model="customer.email" class="mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue" placeholder="tu@correo.com">
                                        <template x-if="formErrors.email"><p class="text-sm text-red-600 mt-1" x-text="formErrors.email"></p></template>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Teléfono</label>
                                        <input type="tel" x-model="customer.phone" class="mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue" placeholder="10 dígitos">
                                        <template x-if="formErrors.phone"><p class="text-sm text-red-600 mt-1" x-text="formErrors.phone"></p></template>
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-1">
                                <div class="bg-white p-6 rounded-lg shadow-xl sticky top-28">
                                    <h2 class="text-xl font-bold text-lumen-blue mb-4 border-b pb-3">Resumen del pedido</h2>
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Sucursal de entrega</label>
                                        <select x-model="sucursal" class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                            <option value="">Selecciona sucursal...</option>
                                            <template x-for="s in sucursales" :key="s">
                                                <option :value="s" x-text="s"></option>
                                            </template>
                                        </select>
                                        <template x-if="formErrors.sucursal"><p class="text-sm text-red-600 mt-1" x-text="formErrors.sucursal"></p></template>
                                    </div>
                                    <div class="flex justify-between items-center text-gray-700 mb-2">
                                        <span>Subtotal:</span>
                                        <span class="font-medium" x-text="'$' + getCartSubtotal().toFixed(2)"></span>
                                    </div>
                                    <template x-if="isFriday">
                                        <div class="flex justify-between items-center text-gray-700 mb-2">
                                            <span>Descuento (20% - Viernes):</span>
                                            <span class="font-medium text-lumen-red" x-text="'- $' + (getCartSubtotal() * discountRate).toFixed(2)"></span>
                                        </div>
                                    </template>
                                    <div class="flex justify-between items-center text-gray-700 mb-4">
                                        <span>Envío:</span>
                                        <span class="font-medium">Recoger en sucursal</span>
                                    </div>
                                    <div class="flex justify-between items-center text-xl font-bold text-lumen-blue border-t pt-4">
                                        <span>Total:</span>
                                        <span class="text-2xl text-lumen-red" x-text="'$' + getCartTotal()"></span>
                                    </div>
                                    <div class="mt-4 text-sm text-gray-600">
                                        <p x-text="getDeliveryMessage()"></p>
                                    </div>
                                    <div class="mt-6">
                                        <label class="flex items-center text-sm text-gray-600">
                                            <input type="checkbox" x-model="termsAccepted" class="rounded border-gray-300 text-lumen-blue shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                            <span class="ml-2">He leído y acepto los <a href="#" @click.prevent="showTerms()" class="text-lumen-blue underline hover:text-lumen-red">Términos</a> y <a href="https://lumen.com.mx/aviso" target="_blank" rel="noopener noreferrer" class="text-lumen-blue underline hover:text-lumen-red">Aviso de Privacidad</a>.</span>
                                        </label>
                                        <template x-if="formErrors.terms"><p class="text-sm text-red-600 mt-1" x-text="formErrors.terms"></p></template>
                                    </div>
                                    <template x-if="checkoutMessage.text">
                                        <div class="mt-4 p-3 rounded-md text-sm" :class="{ 'bg-green-100 text-green-700': checkoutMessage.type === 'success', 'bg-red-100 text-red-700': checkoutMessage.type === 'error', 'bg-blue-100 text-blue-700': checkoutMessage.type === 'info' }">
                                            <span x-text="checkoutMessage.text"></span>
                                        </div>
                                    </template>
                                    <button @click="validateAndGoToCheckout()"
                                            :disabled="isProcessing || !termsAccepted"
                                            class="mt-4 w-full text-center bg-lumen-red text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg transition duration-300"
                                            :class="{ 'opacity-50 cursor-not-allowed': isProcessing || !termsAccepted, 'hover:bg-red-700': !isProcessing && termsAccepted }">
                                        <span x-show="!isProcessing">Ir a Pagar</span>
                                        <span x-show="isProcessing">
                                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                            Validando...
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </section>
        </div>
        <!-- CHECKOUT -->
        <div x-show="view === 'checkout'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
            <section class="container mx-auto px-4 sm:px-6 lg:px-8 my-12">
                <div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-lg shadow-xl">
                    <button @click="showCart()" class="text-sm text-lumen-blue underline hover:text-lumen-red mb-6">&lt; Volver al Carrito</button>
                    <h1 class="text-3xl font-bold text-lumen-blue mb-6 border-b pb-4">Completa tu Pago</h1>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 space-y-6">
                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h3 class="text-lg font-semibold text-lumen-blue mb-3">Forma de Pago</h3>
                                <img src="https://dzh2zima160vx.cloudfront.net/logo/993417c2c470bd1a4c350b1c60e7a718_272_160?Expires=1861920000&Signature=eShM229lVjm0mx0txeRY54k5iER77YCslzdVIta8D1r5a5ZSgeRdKK5kY-w6sfNKMYs~gbrGbwIl1bHjHntTsDqkoENqcFe4FjE2GKrItpzOV~C4JuUEEarW0crYeEErUckoElFqvlsIs-hvBkPzhRCVvEHFiyJKoQwLJBxbuhGbYb-975MYBql6ELk8oyySdhsUnVJl29zgdIQFadYsyIsCa7dzwu5Ajmw1~-yIi6HOyHMeV7X-kqhb3bZttkWT-OL64lX1kVidkMTBbRPOV5hdskF3J4jjy69s2t1V1bgbz3ZFYJZ~tOaJyboVEoJFHbwsMDEjpoY-PIsntlV7mQ__&Key-Pair-Id=APKAII5OVX4LZ3WT422Q" alt="Conekta Logo" class="mx-auto mb-4 w-40 h-auto rounded-md shadow-md">
                                <form id="checkout-form">
                                    <input data-conekta="card[name]" id="conekta-card-name" class="w-full p-3 border-2 rounded-lg mb-2" placeholder="Nombre en la Tarjeta" required type="text">
                                    <input data-conekta="card[number]" id="conekta-card-number" class="w-full p-3 border-2 rounded-lg mb-2" placeholder="Número de Tarjeta" required type="text">
                                    <div class="grid grid-cols-3 gap-2">
                                        <input data-conekta="card[exp_month]" id="conekta-exp-month" class="w-full p-3 border-2 rounded-lg" placeholder="MM" required type="text">
                                        <input data-conekta="card[exp_year]" id="conekta-exp-year" class="w-full p-3 border-2 rounded-lg" placeholder="YY" required type="text">
                                        <input data-conekta="card[cvc]" id="conekta-cvc" class="w-full p-3 border-2 rounded-lg" placeholder="CVC" required type="password">
                                    </div>
                                </form>
                                <div id="card-errors" class="text-sm text-red-600 mt-2"></div>
                                <template x-if="formErrors.card_number"><p class="text-sm text-red-600 mt-1" x-text="formErrors.card_number"></p></template>
                                <template x-if="formErrors.exp_month"><p class="text-sm text-red-600 mt-1" x-text="formErrors.exp_month"></p></template>
                                <template x-if="formErrors.exp_year"><p class="text-sm text-red-600 mt-1" x-text="formErrors.exp_year"></p></template>
                                <template x-if="formErrors.cvc"><p class="text-sm text-red-600 mt-1" x-text="formErrors.cvc"></p></template>
                            </div>
                        </div>
                        <div class="lg:col-span-1">
                            <div class="bg-white p-6 rounded-lg shadow-xl sticky top-28">
                                <h2 class="text-xl font-bold text-lumen-blue mb-4 border-b pb-3">Resumen del pedido</h2>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Sucursal de entrega</label>
                                    <select x-model="sucursal" class="block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                        <option value="">Selecciona sucursal...</option>
                                        <template x-for="s in sucursales" :key="s">
                                            <option :value="s" x-text="s"></option>
                                        </template>
                                        </select>
                                        <template x-if="formErrors.sucursal"><p class="text-sm text-red-600 mt-1" x-text="formErrors.sucursal"></p></template>
                                    </div>
                                    <div class="flex justify-between items-center text-gray-700 mb-2">
                                        <span>Subtotal:</span>
                                        <span class="font-medium" x-text="'$' + getCartSubtotal().toFixed(2)"></span>
                                    </div>
                                    <template x-if="isFriday">
                                        <div class="flex justify-between items-center text-gray-700 mb-2">
                                            <span>Descuento (20% - Viernes):</span>
                                            <span class="font-medium text-lumen-red" x-text="'- $' + (getCartSubtotal() * discountRate).toFixed(2)"></span>
                                        </div>
                                    </template>
                                    <div class="flex justify-between items-center text-gray-700 mb-4">
                                        <span>Envío:</span>
                                        <span class="font-medium">Recoger en sucursal</span>
                                    </div>
                                    <div class="flex justify-between items-center text-xl font-bold text-lumen-blue border-t pt-4">
                                        <span>Total:</span>
                                        <span class="text-2xl text-lumen-red" x-text="'$' + getCartTotal()"></span>
                                    </div>
                                    <div class="mt-4 text-sm text-gray-600">
                                        <p x-text="getDeliveryMessage()"></p>
                                    </div>
                                    <div class="mt-6">
                                        <label class="flex items-center text-sm text-gray-600">
                                            <input type="checkbox" x-model="termsAccepted" class="rounded border-gray-300 text-lumen-blue shadow-sm focus:border-lumen-blue focus:ring-lumen-blue">
                                            <span class="ml-2">He leído y acepto los <a href="#" @click.prevent="showTerms()" class="text-lumen-blue underline hover:text-lumen-red">Términos</a> y <a href="https://lumen.com.mx/aviso" target="_blank" rel="noopener noreferrer" class="text-lumen-blue underline hover:text-lumen-red">Aviso de Privacidad</a>.</span>
                                        </label>
                                        <template x-if="formErrors.terms"><p class="text-sm text-red-600 mt-1" x-text="formErrors.terms"></p></template>
                                    </div>
                                    <template x-if="checkoutMessage.text">
                                        <div class="mt-4 p-3 rounded-md text-sm" :class="{ 'bg-green-100 text-green-700': checkoutMessage.type === 'success', 'bg-red-100 text-red-700': checkoutMessage.type === 'error', 'bg-blue-100 text-blue-700': checkoutMessage.type === 'info' }">
                                            <span x-text="checkoutMessage.text"></span>
                                        </div>
                                    </template>
                                    <button @click="enviarPedido()"
                                            :disabled="isProcessing || !termsAccepted"
                                            class="mt-4 w-full text-center bg-lumen-red text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg transition duration-300"
                                            :class="{ 'opacity-50 cursor-not-allowed': isProcessing || !termsAccepted, 'hover:bg-red-700': !isProcessing && termsAccepted }">
                                        <span x-show="!isProcessing">Pagar</span>
                                        <span x-show="isProcessing">
                                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                            Procesando...
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <!-- THANKYOU -->
        <div x-show="view === 'thankyou'" class="container mx-auto px-4 sm:px-6 lg:px-8 my-12">
            <div class="bg-white p-6 md:p-10 rounded-lg shadow-xl max-w-2xl mx-auto text-center">
                <svg class="w-16 h-16 text-green-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" />
                </svg>
                <h1 class="text-3xl font-bold text-lumen-blue mb-4">¡Gracias por tu pedido!</h1>
                <p class="text-lg text-gray-600 mb-6">Hemos recibido tu pedido y lo estamos procesando. Recibirás una confirmación por correo.</p>
                <p class="text-lg text-gray-600 mb-6">Te recomendamos descargar el PDF de tu pedido en caso de que no recibas el correo en tu bandeja de entrada o spam.</p>
                <button @click="downloadPdf()" class="inline-block bg-lumen-blue text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-blue-900 transition duration-300">
                    Descargar PDF de Pedido
                </button>
                <div class="text-left bg-gray-50 p-6 rounded-lg border mt-6">
                    <h2 class="text-xl font-bold text-lumen-blue mb-4">Resumen del Pedido</h2>
                    <div class="space-y-2">
                        <p><strong>Folio:</strong> <span class="text-lumen-red font-bold" x-text="lastOrder.orderId"></span></p>
                        <p><strong>Cliente:</strong> <span x-text="lastOrder.customer.name"></span></p>
                        <p><strong>Email:</strong> <span x-text="lastOrder.customer.email"></span></p>
                        <p><strong>Recoge en:</strong> <span class="font-semibold" x-text="lastOrder.sucursal"></span></p>
                        <p><strong>Total:</strong> <span class="font-bold text-lg" x-text="'$' + lastOrder.total.toFixed(2)"></span></p>
                    </div>
                    <h3 class="text-lg font-semibold text-lumen-blue mt-6 mb-2 border-t pt-4">Tus servicios:</h3>
                    <ul class="space-y-3">
                        <template x-for="item in lastOrder.items" :key="item.id">
                            <li class="text-sm text-gray-700">
                                <span class="font-semibold" x-text="item.productName"></span> (<span x-text="item.cantidad"></span>x)
                                <ul class="list-disc list-inside pl-4 text-xs">
                                    <li x-show="item.config.material && item.config.material !== 'No aplica'"><strong class="capitalize">Material:</strong> <span x-text="item.config.material"></span></li>
                                    <li x-show="item.config.producto && item.config.producto !== 'No aplica'"><strong class="capitalize">Producto:</strong> <span x-text="item.config.producto"></span></li>
                                    <li x-show="item.config.caras && item.config.caras !== 'No aplica'"><strong class="capitalize">Caras:</strong> <span x-text="item.config.caras"></span></li>
                                    <li x-show="item.config.detalles && item.config.detalles !== 'No aplica'"><strong class="capitalize">Detalles:</strong> <span x-text="item.config.detalles"></span></li>
                                    <li x-show="item.config.pageRange"><strong class="capitalize">Rango Hojas:</strong> <span x-text="item.config.pageRange"></span></li>
                                    <li x-show="item.config.orientacion"><strong class="capitalize">Orientación:</strong> <span x-text="item.config.orientacion"></span></li>
                                    <li x-show="item.config.impresionType && item.config.impresionType !== 'none'"><strong class="capitalize">Tipo Impresión:</strong> <span x-text="item.config.impresionType === 'bn' ? 'B/N' : 'Color'"></span></li>
                                    <li x-show="item.config.impresionCaras"><strong class="capitalize">Caras Impresión:</strong> <span x-text="item.config.impresionCaras === '1 cara (frente)' ? 'Frente' : 'Frente y Atrás'"></span></li>
                                    <li x-show="item.config.extraArillo"><strong class="capitalize">Arillo Extra:</strong> Sí (+$16)</li>
                                </ul>
                            </li>
                        </template>
                    </ul>
                </div>
                <button @click="goHome()" class="mt-8 inline-block bg-lumen-blue text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:bg-blue-900 transition duration-300">
                    Seguir comprando
                </button>
            </div>
        </div>
        <!-- TERMS -->
        <div x-show="view === 'terms'" class="container mx-auto px-4 sm:px-6 lg:px-8 my-12">
            <div class="bg-white p-6 md:p-10 rounded-lg shadow-xl max-w-4xl mx-auto">
                <button @click="goBack()" class="text-sm text-lumen-blue underline hover:text-lumen-red mb-6">&lt; Volver</button>
                <h1 class="text-3xl font-bold text-lumen-blue mb-6">Términos y Condiciones</h1>
                <div class="prose max-w-none">
                    <p>Términos y Condiciones de Uso</p>
                    <p>Última actualización: 10 de diciembre de 2025</p>
                    <p>Bienvenido al micrositio de Impresiones Digitales de Lumen (en adelante, "el Sitio"). Este Sitio es operado por Lumen Impresión Digital, S.A. de C.V. (en adelante, "Lumen" o "nosotros"), con domicilio en [Inserte domicilio fiscal completo, ej. Av. Insurgentes Sur No. 2394, Col. Chimalistac, CDMX, CP 01070, México]. Al acceder y utilizar este Sitio, usted (en adelante, "el Usuario" o "usted") acepta cumplir con estos Términos y Condiciones (en adelante, "T&C"). Si no está de acuerdo con estos T&C, por favor no utilice el Sitio.</p>
                    <p>Estos T&C regulan el uso del Sitio, la contratación de servicios de impresión y relacionados, y cualquier transacción realizada a través de él. Lumen se reserva el derecho de modificar estos T&C en cualquier momento, notificando al Usuario mediante publicación en el Sitio. El uso continuado del Sitio después de tales modificaciones implica la aceptación de las mismas.</p>
                    <h2>1. Descripción de los Servicios</h2>
                    <p>El Sitio ofrece servicios de impresión digital, ploteo, encuadernado, engargolado y sublimación en diversos materiales y formatos, incluyendo pero no limitado a:</p>
                    <ul>
                        <li>Impresiones en blanco y negro (B/N) y color.</li>
                        <li>Ploteo de planos y materiales de gran formato.</li>
                        <li>Impresión de tarjetas y promocionales.</li>
                        <li>Encuadernado (pasta dura o flexible) y engargolado.</li>
                        <li>Sublimación en productos como tazas, mousepads, rompecabezas, botellas y otros artículos promocionales.</li>
                    </ul>
                    <p>Todos los servicios se realizan en México y están disponibles exclusivamente para recolección en las sucursales indicadas en el Sitio (ej. Sucursal Satélite, Relox, etc.). No ofrecemos envíos a domicilio. Los precios mostrados son en pesos mexicanos (MXN) e incluyen IVA, salvo indicación contraria. Los precios pueden variar sin previo aviso.</p>
                    <p>El Usuario debe subir archivos en formato PDF configurados al tamaño final de impresión. No realizamos ajustes adicionales a los archivos proporcionados.</p>
                    <h2>2. Requisitos para Usar el Sitio</h2>
                    <p>- El Usuario debe ser mayor de 18 años o contar con la supervisión de un adulto.</p>
                    <p>- Al realizar un pedido, el Usuario garantiza que la información proporcionada (nombre, email, teléfono, etc.) es veraz y completa.</p>
                    <p>- No se requiere registro de cuenta; los pedidos se procesan de forma individual.</p>
                    <p>- El Sitio utiliza Conekta para procesar pagos con tarjeta. Lumen no almacena datos de tarjetas; estos se manejan directamente por Conekta bajo sus políticas de seguridad.</p>
                    <h2>3. Realización de Pedidos</h2>
                    <p>- El Usuario selecciona el servicio, configura opciones (material, caras, detalles, etc.), sube el archivo PDF (máximo 100 MB) y confirma el pedido.</p>
                    <p>- Los pedidos se consideran aceptados una vez confirmado el pago. Lumen enviará una confirmación por email con el folio del pedido.</p>
                    <p>- No imprimimos archivos con derechos de autor (ej. libros protegidos, material intelectual de terceros). Si se detecta, el pedido será cancelado sin reembolso, y el archivo será eliminado.</p>
                    <p>- Para pedidos de mayoreo (más de 500 hojas en B/N o color), la entrega será al día siguiente, con notificación por email o WhatsApp.</p>
                    <h2>4. Pagos</h2>
                    <p>- Los pagos se realizan en línea mediante tarjeta de crédito/débito vía Conekta.</p>
                    <p>- El total incluye el costo del servicio configurado, más cualquier descuento aplicable (ej. 20% los viernes).</p>
                    <p>- No se entregará el pedido hasta confirmar el pago. En caso de declinación del pago, el pedido se cancelará automáticamente.</p>
                    <p>- Todos los pagos son finales y no reembolsables, salvo en casos de cancelación por parte de Lumen (ver sección 6).</p>
                    <h2>5. Entrega y Recolección</h2>
                    <p>- Los pedidos deben recogerse en la sucursal seleccionada durante el proceso de compra.</p>
                    <p>- Horarios de entrega estimados:</p>
                    <ul>
                        <li>Pedidos antes de las 9:00 AM: Entrega el mismo día, 3 horas después de las 9:00 AM.</li>
                        <li>Pedidos después de las 5:30 PM: Entrega al día siguiente después de las 10:00 AM.</li>
                        <li>Pedidos de mayoreo: Entrega al día siguiente, con notificación.</li>
                    </ul>
                    <p>- El Usuario debe presentar el folio del pedido y una identificación oficial al recoger.</p>
                    <p>- Si el pedido no se recoge en 7 días hábiles, Lumen no garantiza su almacenamiento y puede disponer de él sin responsabilidad.</p>
                    <h2>6. Correcciones y Cargos Adicionales</h2>
                    <p>- Lumen se compromete a realizar los servicios conforme a la configuración seleccionada por el Usuario.</p>
                    <p>- En caso de correcciones debido a resultados no esperados por el cliente al momento de la entrega (ej. variaciones en colores por archivos en RGB en lugar de CMYK, errores en el archivo subido, o ajustes no solicitados inicialmente), estos serán cobrados de manera aparte del servicio solicitado en línea. El costo adicional se calculará según la complejidad y se notificará al Usuario para su aprobación antes de proceder.</p>
                    <p>- No nos responsabilizamos por errores en los archivos proporcionados por el Usuario (ej. resolución baja, márgenes incorrectos).</p>
                    <h2>7. Cancelaciones y Reembolsos</h2>
                    <p>- Los pedidos pueden cancelarse antes de la confirmación de pago sin costo.</p>
                    <p>- Una vez confirmado el pago, no se aceptan cancelaciones ni reembolsos, salvo si Lumen no puede cumplir con el pedido (ej. indisponibilidad en sucursal), en cuyo caso se reembolsará el 100% en un plazo de 5-10 días hábiles.</p>
                    <p>- No hay reembolsos por insatisfacción si el servicio se entregó conforme a la configuración seleccionada.</p>
                    <h2>8. Propiedad Intelectual</h2>
                    <p>- El Usuario garantiza que los archivos subidos no infringen derechos de autor, marcas o propiedad intelectual de terceros. Lumen no es responsable por violaciones y puede rechazar o cancelar pedidos sospechosos.</p>
                    <p>- Todos los derechos sobre el Sitio (diseño, logos, etc.) pertenecen a Lumen. Queda prohibida su reproducción sin autorización.</p>
                    <h2>9. Limitación de Responsabilidad</h2>
                    <p>- Lumen no garantiza la disponibilidad ininterrumpida del Sitio y no es responsable por fallos técnicos, virus o daños indirectos.</p>
                    <p>- La responsabilidad total de Lumen se limita al monto pagado por el servicio. No respondemos por daños consecuenciales, pérdida de datos o lucro cesante.</p>
                    <p>- En caso de fuerza mayor (ej. desastres naturales, huelgas), Lumen puede suspender servicios sin responsabilidad.</p>
                    <h2>10. Protección de Datos</h2>
                    <p>- El manejo de datos personales se rige por nuestro Aviso de Privacidad, disponible en el Sitio. Al usar el Sitio, el Usuario consiente el procesamiento de sus datos para fines de pedidos y notificaciones.</p>
                    <h2>11. Ley Aplicable y Jurisdicción</h2>
                    <p>- Estos T&C se rigen por las leyes de México. Cualquier disputa se resolverá en los tribunales de la Ciudad de México, renunciando a cualquier otro fuero.</p>
                    <h2>12. Contacto</h2>
                    <p>Para dudas o reclamaciones, contáctenos en [inserte email, ej. contacto@lumen.com.mx] o al teléfono [inserte número, ej. 55-1234-5678].</p>
                    <p>Al continuar con su pedido, confirma haber leído y aceptado estos T&C en su totalidad.</p>
                </div>
            </div>
        </div>
        <!-- PRIVACY -->
        <div x-show="view === 'privacy'" class="container mx-auto px-4 sm:px-6 lg:px-8 my-12">
            <div class="bg-white p-6 md:p-10 rounded-lg shadow-xl max-w-4xl mx-auto">
                <button @click="goBack()" class="text-sm text-lumen-blue underline hover:text-lumen-red mb-6">&lt; Volver</button>
                <h1 class="text-3xl font-bold text-lumen-blue mb-6">Aviso de Privacidad</h1>
                <div class="prose max-w-none">
                    <p>Aquí va el texto de tu aviso de privacidad...</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla quis sem at nibh elementum imperdiet. Duis sagittis ipsum. Praesent mauris.</p>
                </div>
            </div>
        </div>
    </main>
    <!-- MODAL CARRITO -->
    <div x-show="showCartModal" @keydown.escape.window="showCartModal = false" class="fixed inset-0 z-50 flex items-center justify-center" style="display: none;">
        <div x-show="showCartModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div x-show="showCartModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 scale-90" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-90"
             @click.away="showCartModal = false"
             class="relative bg-white w-full max-w-md p-6 rounded-lg shadow-xl m-4">
            <button @click="showCartModal = false" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 p-1">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="text-center">
                <svg class="w-16 h-16 text-green-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" />
                </svg>
                <h2 class="text-2xl font-bold text-gray-800 mb-3">¡Agregado al carrito!</h2>
                <p class="text-gray-600 mb-6">Tu servicio ha sido añadido correctamente. ¿Qué deseas hacer ahora?</p>
                <div class="space-y-3 sm:space-y-0 sm:flex sm:gap-3 sm:justify-center">
                    <button @click="showCartModal = false; goHome()" class="w-full sm:w-auto inline-block bg-lumen-blue text-white font-bold py-3 px-6 rounded-full text-base shadow-lg hover:bg-blue-900 transition duration-300">
                        Ver más servicios
                    </button>
                    <button @click="showCartModal = false; showCart()" class="w-full sm:w-auto inline-block bg-lumen-red text-white font-bold py-3 px-6 rounded-full text-base shadow-lg hover:bg-red-700 transition duration-300">
                        Ir al carrito
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Notificación Flotante: Descuento Viernes -->
    <div id="friday-notification" class="notification bg-lumen-yellow text-lumen-blue hidden">
        <span class="close-btn" @click="closeNotification('friday')">✕</span>
        ¡Hoy es viernes! 20% de descuento en todos tus pedidos.
    </div>
  
    <!-- Notificación Flotante: Horarios de Servicio -->
    <div id="schedule-notification" class="notification bg-lumen-red hidden" style="bottom: 100px;">
        <span class="close-btn" @click="closeNotification('schedule')">✕</span>
        <span id="ticker-text"></span>
    </div>
    <footer class="bg-white border-t border-gray-200 mt-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center">
            <div class="flex justify-center gap-6 mb-4">
                <a href="#" @click.prevent="showTerms()" class="text-sm text-gray-600 underline hover:text-lumen-blue hover:no-underline">Términos y Condiciones</a>
                <a href="https://lumen.com.mx/aviso" target="_blank" rel="noopener noreferrer" class="text-sm text-gray-600 underline hover:text-lumen-blue hover:no-underline">Aviso de Privacidad</a>
                <a href="https://lumen.com.mx/facturacion-impresion-digital-lumen" target="_blank" class="text-sm text-gray-600 underline hover:text-lumen-blue hover:no-underline">Facturación en línea</a>
            </div>
            <p class="text-sm text-gray-500">&copy; 2025 Lumen Impresión Digital. Todos los derechos reservados.</p>
        </div>
    </footer>
</body>
</html>
